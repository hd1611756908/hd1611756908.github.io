<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"hd1611756908.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="123456作者: 夜泊1990企鹅: 1611756908鹅群: 948233848邮箱: hd1611756908@163.com博客: https:&#x2F;&#x2F;hd1611756908.github.io&#x2F;B 站: https:&#x2F;&#x2F;space.bilibili.com&#x2F;514155929&#x2F;  第一章 ES简介第1节 ES介绍12341、Elasticsearch是一个基于Lucene的搜索服务器2、">
<meta property="og:type" content="article">
<meta property="og:title" content="ELK笔记">
<meta property="og:url" content="https://hd1611756908.github.io/2024/07/02/elasticsearch%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8(%E5%A4%9C%E6%B3%8A3.6%E7%89%88%E6%9C%AC)/index.html">
<meta property="og:site_name" content="枫桥夜泊">
<meta property="og:description" content="123456作者: 夜泊1990企鹅: 1611756908鹅群: 948233848邮箱: hd1611756908@163.com博客: https:&#x2F;&#x2F;hd1611756908.github.io&#x2F;B 站: https:&#x2F;&#x2F;space.bilibili.com&#x2F;514155929&#x2F;  第一章 ES简介第1节 ES介绍12341、Elasticsearch是一个基于Lucene的搜索服务器2、">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://note.youdao.com/yws/api/personal/file/WEB2d64f18a535bcc41fa2525377deef953?method=download&shareKey=01bc3a0de15bcb0beff502ae379e4f99">
<meta property="og:image" content="https://note.youdao.com/yws/api/personal/file/WEBa082370d84f533e37e4ea5b917d8d4ca?method=download&shareKey=96eaf03ba8681704ff296f21539d814a">
<meta property="og:image" content="https://note.youdao.com/yws/api/personal/file/WEB0c2cf6c12beac90cf956da8adddb81e1?method=download&shareKey=fc77913e32aa18f22010089bfe7f9888">
<meta property="og:image" content="https://note.youdao.com/yws/api/personal/file/WEB0c166f9aba64029505e80c6bf21063d5?method=download&shareKey=4afba56edf5792ceb65836c108d060d1">
<meta property="og:image" content="https://note.youdao.com/yws/api/personal/file/WEB683927128dabde2d93183a9839113a19?method=download&shareKey=17d48375b6fb130cf6a2a8fae5ad78ae">
<meta property="og:image" content="https://note.youdao.com/yws/api/personal/file/WEBee0114c334d559485567119c623a2dad?method=download&shareKey=a95876df2e512b7cc8c16e13987ee2f9">
<meta property="og:image" content="https://note.youdao.com/yws/api/personal/file/WEBe4650dca8d5e767b5c38e3aae96fcfb8?method=download&shareKey=24e1c1fb034f90e2864c177bf04adcc9">
<meta property="og:image" content="https://note.youdao.com/yws/api/personal/file/WEB17d3c1815c1f6335f58e6cc3ab639c95?method=download&shareKey=39b22c3ba6c84b8eca4bc2d1c9a91d9a">
<meta property="og:image" content="https://note.youdao.com/yws/api/personal/file/WEB1345141a8ddfc83fcc6041722d643f50?method=download&shareKey=90d6b0efc383fb4469e018856c88ce14">
<meta property="og:image" content="https://note.youdao.com/yws/api/personal/file/WEB4e77001ccee3d6d92fa15f6845633e07?method=download&shareKey=40f9a78a2a99ca8736c0878788a265c9">
<meta property="og:image" content="https://note.youdao.com/yws/api/personal/file/WEBf58551398ea8893d0597e9dfe036af22?method=download&shareKey=9f4fb0be48d86ac1e3e9cd164ecc7c85">
<meta property="og:image" content="https://note.youdao.com/yws/api/personal/file/WEBd3858fb3757aa53933f2685438ac164a?method=download&shareKey=23f43294ac1bf8f1586e7477a4d8f0e8">
<meta property="og:image" content="https://note.youdao.com/yws/api/personal/file/WEBe1473018a3c715b72bac6929720e407c?method=download&shareKey=5fcfca82d7e93c7e32359dc4b5c62c5f">
<meta property="og:image" content="https://note.youdao.com/yws/api/personal/file/WEB34be6087739e611fe06d33aa45484568?method=download&shareKey=113ef04dd3a060c0cdd12c2c8c6d392a">
<meta property="og:image" content="https://note.youdao.com/yws/api/personal/file/WEB378449d8c1de24c0c4ed7e03f35520d0?method=download&shareKey=ff369fc87bb84391a867d031086cf521">
<meta property="og:image" content="https://note.youdao.com/yws/api/personal/file/WEBe87de8b6f23249a84ec971e861a5c4a3?method=download&shareKey=51954b8d182827a566cf1d38bb8b03ed">
<meta property="og:image" content="https://note.youdao.com/yws/api/personal/file/WEB29862abfb69a19f22949cd6b50687455?method=download&shareKey=aa61c766d5350a9efc8fbd1220c2b07c">
<meta property="og:image" content="https://note.youdao.com/yws/api/personal/file/WEBf368ecdd8daad54090d49c410f198080?method=download&shareKey=b8d107a550419db9195541167c95628d">
<meta property="og:image" content="https://note.youdao.com/yws/api/personal/file/WEB324520b8cc6527b409bc9eae1013cf89?method=download&shareKey=63c09a87e26f0185db22078768d8859b">
<meta property="article:published_time" content="2024-07-02T13:37:11.940Z">
<meta property="article:modified_time" content="2024-07-02T13:40:20.154Z">
<meta property="article:author" content="夜泊1990">
<meta property="article:tag" content="Elasticsearch">
<meta property="article:tag" content="ELK">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://note.youdao.com/yws/api/personal/file/WEB2d64f18a535bcc41fa2525377deef953?method=download&shareKey=01bc3a0de15bcb0beff502ae379e4f99">

<link rel="canonical" href="https://hd1611756908.github.io/2024/07/02/elasticsearch%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8(%E5%A4%9C%E6%B3%8A3.6%E7%89%88%E6%9C%AC)/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>ELK笔记 | 枫桥夜泊</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="枫桥夜泊" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">枫桥夜泊</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">每走一步,都是进步</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://gitee.com/ukoko" class="github-corner" title="Follow me on GitEE" aria-label="Follow me on GitEE" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://hd1611756908.github.io/2024/07/02/elasticsearch%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8(%E5%A4%9C%E6%B3%8A3.6%E7%89%88%E6%9C%AC)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="夜泊1990">
      <meta itemprop="description" content="俱往矣,要多呲花,有多呲花">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫桥夜泊">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ELK笔记
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2024-07-02 21:37:11 / 修改时间：21:40:20" itemprop="dateCreated datePublished" datetime="2024-07-02T21:37:11+08:00">2024-07-02</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/elk/" itemprop="url" rel="index"><span itemprop="name">elk</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>44k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>40 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">作者: 夜泊1990</span><br><span class="line">企鹅: 1611756908</span><br><span class="line">鹅群: 948233848</span><br><span class="line">邮箱: hd1611756908@163.com</span><br><span class="line">博客: https://hd1611756908.github.io/</span><br><span class="line">B 站: https://space.bilibili.com/514155929/</span><br></pre></td></tr></table></figure>

<h2 id="第一章-ES简介"><a href="#第一章-ES简介" class="headerlink" title="第一章 ES简介"></a>第一章 ES简介</h2><h3 id="第1节-ES介绍"><a href="#第1节-ES介绍" class="headerlink" title="第1节 ES介绍"></a>第1节 ES介绍</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1、Elasticsearch是一个基于Lucene的搜索服务器</span><br><span class="line">2、提供了一个分布式的全文搜索引擎,基于restful web接口</span><br><span class="line">3、Elasticsearch是用Java语言开发的，基于Apache协议的开源项目，是目前最受欢迎的企业搜索引擎</span><br><span class="line">4、Elasticsearch广泛运用于云计算中，能够达到实时搜索，具有稳定，可靠，快速的特点</span><br></pre></td></tr></table></figure>
<hr>
<span id="more"></span>

<h3 id="第2节-ES版本"><a href="#第2节-ES版本" class="headerlink" title="第2节 ES版本"></a>第2节 ES版本</h3><ul>
<li>版本历史<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ES : 1.x ---&gt; 2.x ---&gt; 5.x ---&gt; 6.x ---&gt;7.x（目前）</span><br></pre></td></tr></table></figure></li>
<li>版本选择<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在版本选择一般选择5.x版本以上,我们本课程的学习使用6.x版本,低版本会随着官网的不断推动,在未来可能就不维护了,所以在选择的时候要尽量选择目前来说一个长期的稳定版本</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h2 id="第二章-安装-v6-3-2"><a href="#第二章-安装-v6-3-2" class="headerlink" title="第二章 安装(v6.3.2)"></a>第二章 安装(v6.3.2)</h2><h3 id="第1节-window下单点安装ES"><a href="#第1节-window下单点安装ES" class="headerlink" title="第1节 window下单点安装ES"></a>第1节 window下单点安装ES</h3><ul>
<li>下载地址<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">官网地址:</span><br><span class="line">https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.3.1.zip</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">华为镜像站:</span><br><span class="line">https://mirrors.huaweicloud.com/elasticsearch/6.3.2/elasticsearch-6.3.2.zip</span><br></pre></td></tr></table></figure></li>
<li>安装步骤<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1、将下载的安装包解压到指定目录下(不能有中文)</span><br><span class="line">2、找到目录下的bin目录(比如: D:\soft\elasticsearch-6.3.2\bin)</span><br><span class="line">3、bin目录下有一个[elasticsearch.bat]脚本命令,直接鼠标双击即可,启动ES服务</span><br></pre></td></tr></table></figure></li>
<li>访问<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">ES服务的默认端口号为 9200,在浏览器访问 http://localhost:9200/ 浏览器就会输出下面信息,安装成功</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot; : &quot;G7lh1eQ&quot;,</span><br><span class="line">  &quot;cluster_name&quot; : &quot;elasticsearch&quot;,</span><br><span class="line">  &quot;cluster_uuid&quot; : &quot;4T38-ecWQ5O8OpIM3RibAw&quot;,</span><br><span class="line">  &quot;version&quot; : &#123;</span><br><span class="line">    &quot;number&quot; : &quot;6.3.2&quot;,</span><br><span class="line">    &quot;build_flavor&quot; : &quot;default&quot;,</span><br><span class="line">    &quot;build_type&quot; : &quot;zip&quot;,</span><br><span class="line">    &quot;build_hash&quot; : &quot;053779d&quot;,</span><br><span class="line">    &quot;build_date&quot; : &quot;2018-07-20T05:20:23.451332Z&quot;,</span><br><span class="line">    &quot;build_snapshot&quot; : false,</span><br><span class="line">    &quot;lucene_version&quot; : &quot;7.3.1&quot;,</span><br><span class="line">    &quot;minimum_wire_compatibility_version&quot; : &quot;5.6.0&quot;,</span><br><span class="line">    &quot;minimum_index_compatibility_version&quot; : &quot;5.0.0&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;tagline&quot; : &quot;You Know, for Search&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="第2节-window下安装Head插件"><a href="#第2节-window下安装Head插件" class="headerlink" title="第2节 window下安装Head插件"></a>第2节 window下安装Head插件</h3><h4 id="2-1-Head插件介绍"><a href="#2-1-Head插件介绍" class="headerlink" title="2.1 Head插件介绍"></a>2.1 Head插件介绍</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">是一款能连接ES,并提供对ES进行操作的可视化界面</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="2-2-Head插件下载地址"><a href="#2-2-Head插件下载地址" class="headerlink" title="2.2 Head插件下载地址"></a>2.2 Head插件下载地址</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/mobz/elasticsearch-head/archive/master.zip</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="2-3-安装步骤"><a href="#2-3-安装步骤" class="headerlink" title="2.3 安装步骤"></a>2.3 安装步骤</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">1. 电脑首先要安装node.js,因为安装Head插件需要使用npm命令</span><br><span class="line"></span><br><span class="line">注意: 由于npm命令使用的是国外的镜像库,所以可能会很慢或者发生失败的情况,可以有两种方式解决</span><br><span class="line">    方式一: 切换镜像地址</span><br><span class="line">        -- 查看当前npm的镜像地址: npm config get registry</span><br><span class="line">            -- 默认地址为: https://registry.npmjs.org/</span><br><span class="line">        -- 将默认镜像地址设置成淘宝的地址: npm config set registry https://registry.npm.taobao.org</span><br><span class="line">    方式二: 使用cnpm</span><br><span class="line">        -- 下载cnpm并且同时设置镜像源命令 npm install cnpm -g --registry=https://registry.npm.taobao.org</span><br><span class="line">        -- 使用cnpm -v查看</span><br><span class="line">        -- 以后使用cnpm 命令安装依赖</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">2. nodejs安装好之后,那么开始解压head插件压缩包</span><br><span class="line">3. 切换到解压文件目录下 D:\soft\elasticsearch-head-master,我的解压到了d盘soft目录下</span><br><span class="line">4. 使用cmd命令行工具切换到解压目录下,执行命令 npm install 安装</span><br><span class="line">5. 安装完成之后启动head插件 npm run start 这时候就会在在计算机9100端口号上启动服务</span><br><span class="line">6. 在浏览器访问,在浏览器中输入 http://localhost:9100/ 访问</span><br></pre></td></tr></table></figure>

<center>

<img src="https://note.youdao.com/yws/api/personal/file/WEB2d64f18a535bcc41fa2525377deef953?method=download&shareKey=01bc3a0de15bcb0beff502ae379e4f99">

</center>

<hr>
<h4 id="2-4-Head插件和ES关联配置"><a href="#2-4-Head插件和ES关联配置" class="headerlink" title="2.4 Head插件和ES关联配置"></a>2.4 Head插件和ES关联配置</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">因为两个服务之间可能ip地址和端口号不同造成跨域的问题,所以需要配置可以跨域</span><br></pre></td></tr></table></figure>
<ul>
<li>修改ES的配置文件<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1、因为ES和Head插件之间是两个不同的服务,所以需要进行配置</span><br><span class="line">    - 1.1 修改ES的配置,找到我们的ES配置文件 elasticsearch-6.3.2\config\elasticsearch.yml</span><br><span class="line">    - 1.2 在文件的最后一行设置一个可以进行跨域访问的属性</span><br><span class="line">        http:</span><br><span class="line">            cors:</span><br><span class="line">                enabled: true</span><br><span class="line">                allow-origin: &quot;*&quot;</span><br><span class="line">    - 1.3 重启ES服务,重启Head服务</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="第3节-window-ES-集群安装"><a href="#第3节-window-ES-集群安装" class="headerlink" title="第3节 window ES 集群安装"></a>第3节 window ES 集群安装</h3><h4 id="3-1-集群配置步骤"><a href="#3-1-集群配置步骤" class="headerlink" title="3.1 集群配置步骤"></a>3.1 集群配置步骤</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. 创建一个elasticsearch-cluster文件夹</span><br><span class="line">2. 解压我们的elasticsearch-6.3.2.zip压缩包到elasticsearch-cluster目录下</span><br><span class="line">3. 分别命名为 elasticsearch-node01,elasticsearch-node02,elasticsearch-node03</span><br><span class="line">4. 修改配置文件</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="3-2-配置文件编写"><a href="#3-2-配置文件编写" class="headerlink" title="3.2 配置文件编写"></a>3.2 配置文件编写</h4><ul>
<li>elasticsearch-node01节点配置文件<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 集群名称，保证唯一</span><br><span class="line">cluster.name: elasticsearch</span><br><span class="line"># 节点名称，每个节点不能相同</span><br><span class="line">node.name: node-01</span><br><span class="line"># 本机的ip地址</span><br><span class="line">network.host: 127.0.0.1</span><br><span class="line"># 服务端口号，在同一机器下端口号不能相同</span><br><span class="line">http.port: 9200</span><br><span class="line"># 集群间通信端口号，在同一机器下端口号不能相同</span><br><span class="line">transport.tcp.port: 9300</span><br><span class="line"># 设置集群自动发现机器ip集合</span><br><span class="line">discovery.zen.ping.unicast.hosts: [&quot;127.0.0.1:9300&quot;,&quot;127.0.0.1:9301&quot;,&quot;127.0.0.1:9302&quot;]</span><br><span class="line"># 跨域调用</span><br><span class="line">http:</span><br><span class="line">  cors:</span><br><span class="line">      enabled: true</span><br><span class="line">      allow-origin: &quot;*&quot;</span><br></pre></td></tr></table></figure></li>
<li>elasticsearch-node02节点配置文件<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 集群名称，保证唯一</span><br><span class="line">cluster.name: elasticsearch</span><br><span class="line"># 节点名称，每个节点不能相同</span><br><span class="line">node.name: node-02</span><br><span class="line"># 本机的ip地址</span><br><span class="line">network.host: 127.0.0.1</span><br><span class="line"># 服务端口号，在同一机器下端口号不能相同</span><br><span class="line">http.port: 9201</span><br><span class="line"># 集群间通信端口号，在同一机器下端口号不能相同</span><br><span class="line">transport.tcp.port: 9301</span><br><span class="line"># 设置集群自动发现机器ip集合</span><br><span class="line">discovery.zen.ping.unicast.hosts: [&quot;127.0.0.1:9300&quot;,&quot;127.0.0.1:9301&quot;,&quot;127.0.0.1:9302&quot;]</span><br><span class="line"># 跨域调用</span><br><span class="line">http:</span><br><span class="line">  cors:</span><br><span class="line">      enabled: true</span><br><span class="line">      allow-origin: &quot;*&quot;</span><br></pre></td></tr></table></figure></li>
<li>elasticsearch-node03节点配置文件<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 集群名称，保证唯一</span><br><span class="line">cluster.name: elasticsearch</span><br><span class="line"># 节点名称，每个节点不能相同</span><br><span class="line">node.name: node-03</span><br><span class="line"># 本机的ip地址</span><br><span class="line">network.host: 127.0.0.1</span><br><span class="line"># 服务端口号，在同一机器下端口号不能相同</span><br><span class="line">http.port: 9202</span><br><span class="line"># 集群间通信端口号，在同一机器下端口号不能相同</span><br><span class="line">transport.tcp.port: 9302</span><br><span class="line"># 设置集群自动发现机器ip集合</span><br><span class="line">discovery.zen.ping.unicast.hosts: [&quot;127.0.0.1:9300&quot;,&quot;127.0.0.1:9301&quot;,&quot;127.0.0.1:9302&quot;]</span><br><span class="line"># 跨域调用</span><br><span class="line">http:</span><br><span class="line">  cors:</span><br><span class="line">      enabled: true</span><br><span class="line">      allow-origin: &quot;*&quot;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">重启各个节点</span><br><span class="line"></span><br><span class="line">注意: 如果在重启各个节点时出现点击启动脚本闪退的问题,可能造成的原因是配置文件需要使用UTF-8编码的格式编写</span><br><span class="line">解决方式,使用notepad++修改当前配置文件的编码格式为utf-8</span><br><span class="line"></span><br><span class="line">重启Head服务</span><br></pre></td></tr></table></figure></li>
</ul>
<center>

<img src="https://note.youdao.com/yws/api/personal/file/WEBa082370d84f533e37e4ea5b917d8d4ca?method=download&shareKey=96eaf03ba8681704ff296f21539d814a">

</center>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. 图中黑色的粗框代表这分片</span><br><span class="line">2. 细的黑框代表着副本</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="第三章-基础概念"><a href="#第三章-基础概念" class="headerlink" title="第三章 基础概念"></a>第三章 基础概念</h2><h3 id="第1节-索引"><a href="#第1节-索引" class="headerlink" title="第1节 索引"></a>第1节 索引</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">含有相同属性的文档集合,相当于我们MYSQL数据库中的数据库(DATABASE)</span><br></pre></td></tr></table></figure>
<h3 id="第2节-类型"><a href="#第2节-类型" class="headerlink" title="第2节 类型"></a>第2节 类型</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">索引可以定义一个或多个类型(ES6中已经逐步弃用,在更高的7版本中已经删除),文档必须属于一个类型,相当于我们MYSQL中的一个表(TABLE)</span><br></pre></td></tr></table></figure>
<h3 id="第3节-文档"><a href="#第3节-文档" class="headerlink" title="第3节 文档"></a>第3节 文档</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">文档是可以被索引的基本数据单位,相当于MYSQL数据库表中的一行记录</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="第4节-分片-x2F-副本-备份"><a href="#第4节-分片-x2F-副本-备份" class="headerlink" title="第4节 分片&#x2F;副本(备份)"></a>第4节 分片&#x2F;副本(备份)</h3><ul>
<li>分片(shard)<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 每个索引有一个或多个分片</span><br><span class="line">2. 索引的数据被分配到各个分片上,相当于一桶水使用多个杯子去装,分片有助于横向扩展</span><br><span class="line">3. 如果将大量的数据保存到一个分片里面,那么分片越来越大数据越来越多,查找性能越来越差</span><br><span class="line">4. 默认情况下一个索引创建5个分片</span><br><span class="line">5. 分片会默认的分配到es集群的各个节点上,集群自动完成</span><br></pre></td></tr></table></figure></li>
<li>副本(replica)<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. 副本,可以理解为分片的备份</span><br><span class="line">2. 主分片和副本(备分片)不会出现在同一个节点上(防止单点故障)默认情况下一个索引创建5个分片一个备份(5个主分片+5个副本分片=10个分片)</span><br><span class="line">3. 如果只有一个es节点,那么replica就无法分配(因为主/副不能同在一个节点上),此时cluster status会变成Yellow</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h2 id="第四章-基本用法"><a href="#第四章-基本用法" class="headerlink" title="第四章 基本用法"></a>第四章 基本用法</h2><h3 id="第1节-ES-的-RESTFul-API"><a href="#第1节-ES-的-RESTFul-API" class="headerlink" title="第1节 ES 的 RESTFul API"></a>第1节 ES 的 RESTFul API</h3><ul>
<li>API的基本格式<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://&lt;ip&gt;:&lt;port&gt;/&lt;索引&gt;/&lt;类型&gt;/&lt;文档id&gt;</span><br></pre></td></tr></table></figure></li>
<li>常用的HTTP动作<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET/POST/PUT/DELETE</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="第2节-创建索引"><a href="#第2节-创建索引" class="headerlink" title="第2节 创建索引"></a>第2节 创建索引</h3><h4 id="2-1-使用Head插件创建索引"><a href="#2-1-使用Head插件创建索引" class="headerlink" title="2.1 使用Head插件创建索引"></a>2.1 使用Head插件创建索引</h4><ul>
<li>创建索引的步骤<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 登陆Head页面</span><br><span class="line">2. 找到索引标签</span><br><span class="line">3. 新建索引</span><br><span class="line">4. 添加索引名称(英文,全部都是小写字母,不能用下划线开头)</span><br><span class="line">5. 索引创建成功之后回到概览页面就会在上面发现我们新建的索引</span><br></pre></td></tr></table></figure></li>
<li>Head页面展示</li>
</ul>
<center>

<img src="https://note.youdao.com/yws/api/personal/file/WEB0c2cf6c12beac90cf956da8adddb81e1?method=download&shareKey=fc77913e32aa18f22010089bfe7f9888">

</center>

<hr>
<h4 id="2-2-结构化索引-x2F-非结构化索引"><a href="#2-2-结构化索引-x2F-非结构化索引" class="headerlink" title="2.2 结构化索引&#x2F;非结构化索引"></a>2.2 结构化索引&#x2F;非结构化索引</h4><ul>
<li>结构化和非结构化介绍</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">进入我们的Head界面,进入概览,点击索引名称下面的信息,点击索引信息,查看数据里面有一个mappings属性,内容为空,说明我们此索引为非结构化索引</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;state&quot;: &quot;open&quot;,</span><br><span class="line">    &quot;settings&quot;: &#123;</span><br><span class="line">        &quot;index&quot;: &#123;</span><br><span class="line">            &quot;creation_date&quot;: &quot;1597547149325&quot;,</span><br><span class="line">            &quot;number_of_shards&quot;: &quot;5&quot;,</span><br><span class="line">            &quot;number_of_replicas&quot;: &quot;1&quot;,</span><br><span class="line">            &quot;uuid&quot;: &quot;UvYCPtp0TZeCiPexCT517g&quot;,</span><br><span class="line">            &quot;version&quot;: &#123;</span><br><span class="line">                &quot;created&quot;: &quot;6030299&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;provided_name&quot;: &quot;book&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;mappings&quot;: &#123;&#125;,</span><br><span class="line">    &quot;aliases&quot;: [],</span><br><span class="line">    &quot;primary_terms&quot;: &#123;</span><br><span class="line">        &quot;0&quot;: 1,</span><br><span class="line">        &quot;1&quot;: 1,</span><br><span class="line">        &quot;2&quot;: 1,</span><br><span class="line">        &quot;3&quot;: 1,</span><br><span class="line">        &quot;4&quot;: 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;in_sync_allocations&quot;: &#123;</span><br><span class="line">        &quot;0&quot;: [</span><br><span class="line">            &quot;BHBNGrGCSiOl-wuKptvGtQ&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;1&quot;: [</span><br><span class="line">            &quot;yMyL9GsMR9SziVr9OK_Uxw&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;2&quot;: [</span><br><span class="line">            &quot;b8EGEtGlTySAqvlKPtW_EA&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;3&quot;: [</span><br><span class="line">            &quot;0azU6MwTSCqMdzVXyuPVrw&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;4&quot;: [</span><br><span class="line">            &quot;DY2oxeUuSNaxva5dgKTSAg&quot;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>结构化和非结构化转化<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1、在当前的head页面中点击【复合查询】</span><br><span class="line">2、调用ES的API构建一个请求url</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">我这里给book索引添加一个author类型,使用_mappings关键字(ES给索引、类型、文档等起名字时不能以下划线开头,因为ES中很多关键字都是以下划线开头的)</span><br></pre></td></tr></table></figure>
<center></li>
</ul>
<img src="https://note.youdao.com/yws/api/personal/file/WEB0c166f9aba64029505e80c6bf21063d5?method=download&shareKey=4afba56edf5792ceb65836c108d060d1">

</center>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">3、给上面的非结构化索引添加一些结构化的数据,让他变成结构化索引</span><br><span class="line"></span><br><span class="line">点击易读,点击验证json,防止自己写的json数据有问题,点击提交请求</span><br><span class="line"></span><br><span class="line">properties: 关键字,设置属性</span><br><span class="line">type: 关键字,设置属性类型</span><br><span class="line">&#123;</span><br><span class="line">    &quot;author&quot;: &#123;</span><br><span class="line">        &quot;properties&quot;: &#123;</span><br><span class="line">            &quot;author_name&quot;: &#123;</span><br><span class="line">                &quot;type&quot;: &quot;text&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">4、添加成功标志</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;acknowledged&quot;: true</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">5、在进入概览点击索引信息查看数据(mappings中就有了机构化数据)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;state&quot;: &quot;open&quot;,</span><br><span class="line">    &quot;settings&quot;: &#123;</span><br><span class="line">        &quot;index&quot;: &#123;</span><br><span class="line">            &quot;creation_date&quot;: &quot;1597547149325&quot;,</span><br><span class="line">            &quot;number_of_shards&quot;: &quot;5&quot;,</span><br><span class="line">            &quot;number_of_replicas&quot;: &quot;1&quot;,</span><br><span class="line">            &quot;uuid&quot;: &quot;UvYCPtp0TZeCiPexCT517g&quot;,</span><br><span class="line">            &quot;version&quot;: &#123;</span><br><span class="line">                &quot;created&quot;: &quot;6030299&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;provided_name&quot;: &quot;book&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;mappings&quot;: &#123;</span><br><span class="line">        &quot;author&quot;: &#123;</span><br><span class="line">            &quot;properties&quot;: &#123;</span><br><span class="line">                &quot;author_name&quot;: &#123;</span><br><span class="line">                    &quot;type&quot;: &quot;text&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;aliases&quot;: [],</span><br><span class="line">    &quot;primary_terms&quot;: &#123;</span><br><span class="line">        &quot;0&quot;: 1,</span><br><span class="line">        &quot;1&quot;: 1,</span><br><span class="line">        &quot;2&quot;: 1,</span><br><span class="line">        &quot;3&quot;: 1,</span><br><span class="line">        &quot;4&quot;: 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;in_sync_allocations&quot;: &#123;</span><br><span class="line">        &quot;0&quot;: [</span><br><span class="line">            &quot;BHBNGrGCSiOl-wuKptvGtQ&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;1&quot;: [</span><br><span class="line">            &quot;yMyL9GsMR9SziVr9OK_Uxw&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;2&quot;: [</span><br><span class="line">            &quot;b8EGEtGlTySAqvlKPtW_EA&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;3&quot;: [</span><br><span class="line">            &quot;0azU6MwTSCqMdzVXyuPVrw&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;4&quot;: [</span><br><span class="line">            &quot;DY2oxeUuSNaxva5dgKTSAg&quot;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="2-3-使用postman创建索引"><a href="#2-3-使用postman创建索引" class="headerlink" title="2.3 使用postman创建索引"></a>2.3 使用postman创建索引</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Head在进行结构化数据创建的时候,验证json数据格式比较麻烦,我们可以使用postman进行结构化数据创建</span><br></pre></td></tr></table></figure>

<ul>
<li>使用postman创建索引</li>
</ul>
<center>

<img src="https://note.youdao.com/yws/api/personal/file/WEB683927128dabde2d93183a9839113a19?method=download&shareKey=17d48375b6fb130cf6a2a8fae5ad78ae">

</center>

<ul>
<li>postman创建索引的请求数据<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;settings&quot;:&#123;</span><br><span class="line">		&quot;number_of_shards&quot;:5,</span><br><span class="line">		&quot;number_of_replicas&quot;:1</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;mappings&quot;:&#123;</span><br><span class="line">		&quot;man&quot;:&#123;</span><br><span class="line">			&quot;properties&quot;:&#123;</span><br><span class="line">				&quot;name&quot;:&#123;</span><br><span class="line">					&quot;type&quot;:&quot;text&quot;</span><br><span class="line">				&#125;,</span><br><span class="line">				&quot;country&quot;:&#123;</span><br><span class="line">					&quot;type&quot;:&quot;keyword&quot;</span><br><span class="line">				&#125;,</span><br><span class="line">				&quot;age&quot;:&#123;</span><br><span class="line">					&quot;type&quot;:&quot;integer&quot;</span><br><span class="line">				&#125;,</span><br><span class="line">				&quot;date&quot;:&#123;</span><br><span class="line">					&quot;type&quot;:&quot;date&quot;,</span><br><span class="line">					&quot;format&quot;:&quot;yyyy-MM-dd HH:mm:ss || yyyy-MM-dd || epoch_millis&quot;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-----------------------------参数变量的简单介绍----------------------------------</span><br><span class="line"></span><br><span class="line">settings     : 设置当前索引的基本信息</span><br><span class="line">mappings     : 结构化索引配置</span><br><span class="line">format       : 时间格式</span><br><span class="line">epoch_millis : 时间戳(毫秒数)</span><br></pre></td></tr></table></figure></li>
<li>head页面查看创建结果</li>
</ul>
<center>

<img src="https://note.youdao.com/yws/api/personal/file/WEBee0114c334d559485567119c623a2dad?method=download&shareKey=a95876df2e512b7cc8c16e13987ee2f9">

</center>

<hr>
<h3 id="第3节-数据插入-postman"><a href="#第3节-数据插入-postman" class="headerlink" title="第3节 数据插入(postman)"></a>第3节 数据插入(postman)</h3><h4 id="3-1-指定id插入"><a href="#3-1-指定id插入" class="headerlink" title="3.1 指定id插入"></a>3.1 指定id插入</h4><ul>
<li>请求地址<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:9200/people/man/1</span><br></pre></td></tr></table></figure></li>
<li>请求图例</li>
</ul>
<center>

<img src="https://note.youdao.com/yws/api/personal/file/WEBe4650dca8d5e767b5c38e3aae96fcfb8?method=download&shareKey=24e1c1fb034f90e2864c177bf04adcc9">

</center>

<ul>
<li>添加数据<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;name&quot;:&quot;枫桥夜泊1990&quot;,</span><br><span class="line">	&quot;country&quot;:&quot;中国&quot;,</span><br><span class="line">	&quot;age&quot;:30,</span><br><span class="line">	&quot;date&quot;:&quot;1990-05-28&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>返回结果数据<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;_index&quot;: &quot;people&quot;,</span><br><span class="line">    &quot;_type&quot;: &quot;man&quot;,</span><br><span class="line">    &quot;_id&quot;: &quot;1&quot;,</span><br><span class="line">    &quot;_version&quot;: 1,</span><br><span class="line">    &quot;result&quot;: &quot;created&quot;,</span><br><span class="line">    &quot;_shards&quot;: &#123;</span><br><span class="line">        &quot;total&quot;: 2,</span><br><span class="line">        &quot;successful&quot;: 1,</span><br><span class="line">        &quot;failed&quot;: 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;_seq_no&quot;: 0,</span><br><span class="line">    &quot;_primary_term&quot;: 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>head查看</li>
</ul>
<center>

<img src="https://note.youdao.com/yws/api/personal/file/WEB17d3c1815c1f6335f58e6cc3ab639c95?method=download&shareKey=39b22c3ba6c84b8eca4bc2d1c9a91d9a">

</center>

<hr>
<center>

<img src="https://note.youdao.com/yws/api/personal/file/WEB1345141a8ddfc83fcc6041722d643f50?method=download&shareKey=90d6b0efc383fb4469e018856c88ce14">

</center>

<hr>
<h4 id="3-2-自动生成id插入"><a href="#3-2-自动生成id插入" class="headerlink" title="3.2 自动生成id插入"></a>3.2 自动生成id插入</h4><ul>
<li>请求地址<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:9200/people/man/</span><br></pre></td></tr></table></figure></li>
<li>请求图例</li>
</ul>
<center>

<img src="https://note.youdao.com/yws/api/personal/file/WEB4e77001ccee3d6d92fa15f6845633e07?method=download&shareKey=40f9a78a2a99ca8736c0878788a265c9">

</center>

<ul>
<li>head查看</li>
</ul>
<center>

<img src="https://note.youdao.com/yws/api/personal/file/WEBf58551398ea8893d0597e9dfe036af22?method=download&shareKey=9f4fb0be48d86ac1e3e9cd164ecc7c85">

</center>

<hr>
<h3 id="第4节-数据修改-postman"><a href="#第4节-数据修改-postman" class="headerlink" title="第4节 数据修改(postman)"></a>第4节 数据修改(postman)</h3><h4 id="4-1-直接修改文档"><a href="#4-1-直接修改文档" class="headerlink" title="4.1 直接修改文档"></a>4.1 直接修改文档</h4><ul>
<li>请求地址<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:9200/people/man/1/_update</span><br></pre></td></tr></table></figure></li>
<li>请求参数<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;doc&quot;:&#123;</span><br><span class="line">		&quot;name&quot;:&quot;我是枫桥夜泊1990&quot;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>请求图例</li>
</ul>
<center>

<img src="https://note.youdao.com/yws/api/personal/file/WEBd3858fb3757aa53933f2685438ac164a?method=download&shareKey=23f43294ac1bf8f1586e7477a4d8f0e8">

</center>

<ul>
<li>响应数据<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;_index&quot;: &quot;people&quot;,</span><br><span class="line">    &quot;_type&quot;: &quot;man&quot;,</span><br><span class="line">    &quot;_id&quot;: &quot;1&quot;,</span><br><span class="line">    &quot;_version&quot;: 2,</span><br><span class="line">    &quot;result&quot;: &quot;updated&quot;,</span><br><span class="line">    &quot;_shards&quot;: &#123;</span><br><span class="line">        &quot;total&quot;: 2,</span><br><span class="line">        &quot;successful&quot;: 1,</span><br><span class="line">        &quot;failed&quot;: 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;_seq_no&quot;: 2,</span><br><span class="line">    &quot;_primary_term&quot;: 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>head查看</li>
</ul>
<center>

<img src="https://note.youdao.com/yws/api/personal/file/WEBe1473018a3c715b72bac6929720e407c?method=download&shareKey=5fcfca82d7e93c7e32359dc4b5c62c5f">

</center>

<hr>
<h4 id="4-2-使用脚本修改文档-了解"><a href="#4-2-使用脚本修改文档-了解" class="headerlink" title="4.2 使用脚本修改文档(了解)"></a>4.2 使用脚本修改文档(了解)</h4><h5 id="4-2-1-Painless简介"><a href="#4-2-1-Painless简介" class="headerlink" title="4.2.1 Painless简介"></a>4.2.1 Painless简介</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. Painless 是默认情况下 Elasticsearch 中提供的一种简单，安全的脚本语言</span><br><span class="line">2. 它专门设计用于 Elasticsearch，可以安全地使用内联和存储的脚本，默认情况下启用</span><br></pre></td></tr></table></figure>
<h5 id="4-2-2-Painless使用"><a href="#4-2-2-Painless使用" class="headerlink" title="4.2.2  Painless使用"></a>4.2.2  Painless使用</h5><ul>
<li>请求地址<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:9200/people/man/1/_update</span><br></pre></td></tr></table></figure></li>
<li>请求参数<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">方式一:</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">	&quot;script&quot;:&#123;</span><br><span class="line">		&quot;lang&quot;:&quot;painless&quot;,</span><br><span class="line">		&quot;inline&quot;:&quot;ctx._source.age -=10&quot;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">方式二:</span><br><span class="line">&#123;</span><br><span class="line">	&quot;script&quot;:&#123;</span><br><span class="line">		&quot;lang&quot;:&quot;painless&quot;,</span><br><span class="line">		&quot;inline&quot;:&quot;ctx._source.age = params.age&quot;,</span><br><span class="line">		&quot;params&quot;:&#123;</span><br><span class="line">			&quot;age&quot;:21</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>请求图例</li>
</ul>
<center>

<img src="https://note.youdao.com/yws/api/personal/file/WEB34be6087739e611fe06d33aa45484568?method=download&shareKey=113ef04dd3a060c0cdd12c2c8c6d392a">

</center>

<hr>
<h3 id="第5节-数据删除-postman"><a href="#第5节-数据删除-postman" class="headerlink" title="第5节 数据删除(postman)"></a>第5节 数据删除(postman)</h3><h4 id="5-1-删除文档-postman"><a href="#5-1-删除文档-postman" class="headerlink" title="5.1 删除文档(postman)"></a>5.1 删除文档(postman)</h4><ul>
<li>请求地址<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:9200/people/man/1</span><br></pre></td></tr></table></figure></li>
<li>请求图例</li>
</ul>
<center>

<img src="https://note.youdao.com/yws/api/personal/file/WEB378449d8c1de24c0c4ed7e03f35520d0?method=download&shareKey=ff369fc87bb84391a867d031086cf521">

</center>

<hr>
<h4 id="5-2-删除索引-postman"><a href="#5-2-删除索引-postman" class="headerlink" title="5.2 删除索引(postman)"></a>5.2 删除索引(postman)</h4><ul>
<li>请求地址<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:9200/people</span><br></pre></td></tr></table></figure></li>
<li>请求图例</li>
</ul>
<center>

<img src="https://note.youdao.com/yws/api/personal/file/WEBe87de8b6f23249a84ec971e861a5c4a3?method=download&shareKey=51954b8d182827a566cf1d38bb8b03ed">

</center>

<hr>
<h4 id="5-3-使用head删除索引"><a href="#5-3-使用head删除索引" class="headerlink" title="5.3 使用head删除索引"></a>5.3 使用head删除索引</h4><ul>
<li>图例演示</li>
</ul>
<center>

<img src="https://note.youdao.com/yws/api/personal/file/WEB29862abfb69a19f22949cd6b50687455?method=download&shareKey=aa61c766d5350a9efc8fbd1220c2b07c">

</center>

<hr>
<h2 id="第五章-高级查询-Kibana"><a href="#第五章-高级查询-Kibana" class="headerlink" title="第五章 高级查询(Kibana)"></a>第五章 高级查询(Kibana)</h2><h3 id="第1节-Kibana安装"><a href="#第1节-Kibana安装" class="headerlink" title="第1节 Kibana安装"></a>第1节 Kibana安装</h3><h4 id="1-1-Kibana简介"><a href="#1-1-Kibana简介" class="headerlink" title="1.1 Kibana简介"></a>1.1 Kibana简介</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Kibana是一个针对Elasticsearch的开源分析及可视化平台,用来搜索、查看交互存储在Elasticsearch索引中的数据.使用Kibana,可以通过各种图表进行高级数据分析及展示</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="1-2-Kibana下载"><a href="#1-2-Kibana下载" class="headerlink" title="1.2 Kibana下载"></a>1.2 Kibana下载</h4><ul>
<li>官网地址<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.elastic.co/cn/kibana</span><br></pre></td></tr></table></figure></li>
<li>华为云地址<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://mirrors.huaweicloud.com/kibana/6.3.2/kibana-6.3.2-windows-x86_64.zip</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h4 id="1-3-Kibana安装"><a href="#1-3-Kibana安装" class="headerlink" title="1.3 Kibana安装"></a>1.3 Kibana安装</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1、将下载的kibana-6.3.2-windows-x86_64.zip压缩包解压到指定文件夹下</span><br><span class="line">2、在bin目录下D:\soft\kibana-6.3.2-windows-x86_64\bin找到kibana.bat</span><br><span class="line">3、双击运行即可</span><br><span class="line">4、浏览器访问 http://localhost:5601/进入 Dev Tools选项</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="第2节-Kibana使用"><a href="#第2节-Kibana使用" class="headerlink" title="第2节 Kibana使用"></a>第2节 Kibana使用</h3><h4 id="2-1-基本操作"><a href="#2-1-基本操作" class="headerlink" title="2.1 基本操作"></a>2.1 基本操作</h4><h5 id="2-1-1-查看集群健康状态"><a href="#2-1-1-查看集群健康状态" class="headerlink" title="2.1.1 查看集群健康状态"></a>2.1.1 查看集群健康状态</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /_cat/health?v</span><br></pre></td></tr></table></figure>
<hr>
<h5 id="2-1-2-查看节点状态"><a href="#2-1-2-查看节点状态" class="headerlink" title="2.1.2 查看节点状态"></a>2.1.2 查看节点状态</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /_cat/nodes?v</span><br></pre></td></tr></table></figure>
<hr>
<h5 id="2-1-3-查看索引信息"><a href="#2-1-3-查看索引信息" class="headerlink" title="2.1.3 查看索引信息"></a>2.1.3 查看索引信息</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /_cat/indices?v</span><br></pre></td></tr></table></figure>
<hr>
<h5 id="2-1-4-创建索引"><a href="#2-1-4-创建索引" class="headerlink" title="2.1.4 创建索引"></a>2.1.4 创建索引</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1. 命令 PUT /book</span><br><span class="line"></span><br><span class="line">2. 返回结果</span><br><span class="line">&#123;</span><br><span class="line">  &quot;acknowledged&quot;: true,</span><br><span class="line">  &quot;shards_acknowledged&quot;: true,</span><br><span class="line">  &quot;index&quot;: &quot;book&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h5 id="2-1-5-删除索引"><a href="#2-1-5-删除索引" class="headerlink" title="2.1.5 删除索引"></a>2.1.5 删除索引</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 命令  DELETE /book</span><br><span class="line">2. 返回结果</span><br><span class="line">&#123;</span><br><span class="line">  &quot;acknowledged&quot;: true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h5 id="2-1-6-向文档中添加数据"><a href="#2-1-6-向文档中添加数据" class="headerlink" title="2.1.6 向文档中添加数据"></a>2.1.6 向文档中添加数据</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PUT /book/doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;:&quot;李雷&quot;,</span><br><span class="line">  &quot;age&quot;:18</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h5 id="2-1-7-查看文档类型"><a href="#2-1-7-查看文档类型" class="headerlink" title="2.1.7 查看文档类型"></a>2.1.7 查看文档类型</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET /book/doc/_mapping</span><br><span class="line"></span><br><span class="line">GET: 请求方式</span><br><span class="line">book: 索引(相当于MYSQL数据库的库名)</span><br><span class="line">doc : 类型(相当于数据库的表名)</span><br><span class="line">_mapping: ES的关键字查询文档类型</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h5 id="2-1-8-查看索引中的文档-根据ID查询"><a href="#2-1-8-查看索引中的文档-根据ID查询" class="headerlink" title="2.1.8 查看索引中的文档(根据ID查询)"></a>2.1.8 查看索引中的文档(根据ID查询)</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /book/doc/1</span><br></pre></td></tr></table></figure>
<hr>
<h5 id="2-1-9-更新索引中的文档"><a href="#2-1-9-更新索引中的文档" class="headerlink" title="2.1.9 更新索引中的文档"></a>2.1.9 更新索引中的文档</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">POST /book/doc/1/_update</span><br><span class="line">&#123;</span><br><span class="line">  &quot;doc&quot;:&#123;</span><br><span class="line">    &quot;name&quot;:&quot;韩梅梅&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST   : 请求方式</span><br><span class="line">book   : 索引名称</span><br><span class="line">doc    : 类型</span><br><span class="line">1      : 文档id</span><br><span class="line">_update: 关键字,用于更新</span><br></pre></td></tr></table></figure>
<hr>
<h5 id="2-1-10-删除索引中的文档"><a href="#2-1-10-删除索引中的文档" class="headerlink" title="2.1.10 删除索引中的文档"></a>2.1.10 删除索引中的文档</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE /book/doc/2</span><br></pre></td></tr></table></figure>
<hr>
<h5 id="2-1-11-对索引中的文档进行批量操作"><a href="#2-1-11-对索引中的文档进行批量操作" class="headerlink" title="2.1.11 对索引中的文档进行批量操作"></a>2.1.11 对索引中的文档进行批量操作</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST /book/doc/_bulk</span><br><span class="line">&#123;&quot;index&quot;:&#123;&quot;_id&quot;:&quot;3&quot;&#125;&#125;</span><br><span class="line">&#123;&quot;name&quot;: &quot;John Doe&quot; &#125;</span><br><span class="line">&#123;&quot;index&quot;:&#123;&quot;_id&quot;:&quot;4&quot;&#125;&#125;</span><br><span class="line">&#123;&quot;name&quot;: &quot;Jane Doe&quot; &#125;</span><br><span class="line"></span><br><span class="line">_bulk: 批量操作</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="2-2-高级查询"><a href="#2-2-高级查询" class="headerlink" title="2.2 高级查询"></a>2.2 高级查询</h4><h5 id="2-2-1-数据导入"><a href="#2-2-1-数据导入" class="headerlink" title="2.2.1 数据导入"></a>2.2.1 数据导入</h5><ul>
<li>数据地址<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/macrozheng/mall-learning/blob/master/document/json/accounts.json</span><br></pre></td></tr></table></figure></li>
<li>导入命令(批量)<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST /bank/account/_bulk</span><br><span class="line">//这里放上面的数据地址中的数据</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h5 id="2-2-2-高级查询"><a href="#2-2-2-高级查询" class="headerlink" title="2.2.2 高级查询"></a>2.2.2 高级查询</h5><hr>
<h6 id="2-2-2-1-简单搜索"><a href="#2-2-2-1-简单搜索" class="headerlink" title="2.2.2.1 简单搜索"></a>2.2.2.1 简单搜索</h6><ul>
<li>搜索全部(match_all)<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123; &quot;match_all&quot;: &#123;&#125; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>分页搜索(from表示偏移量,从0开始,size表示每页显示的数量)<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123; &quot;match_all&quot;: &#123;&#125; &#125;,</span><br><span class="line">  &quot;from&quot;: 0,</span><br><span class="line">  &quot;size&quot;: 10</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>搜索排序(sort)<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123; &quot;match_all&quot;: &#123;&#125; &#125;,</span><br><span class="line">  &quot;sort&quot;: &#123; &quot;balance&quot;: &#123; &quot;order&quot;: &quot;desc&quot; &#125; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">使用sort关键字 以balance字段排序,设置order属性的值为desc倒叙输出</span><br></pre></td></tr></table></figure></li>
<li>搜索并返回指定字段内容(_source)<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123; &quot;match_all&quot;: &#123;&#125; &#125;,</span><br><span class="line">  &quot;_source&quot;: [&quot;account_number&quot;, &quot;balance&quot;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">_source: 将要查询出来的属性设置到_source数组中</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h6 id="2-2-2-2-条件搜索-match"><a href="#2-2-2-2-条件搜索-match" class="headerlink" title="2.2.2.2 条件搜索(match)"></a>2.2.2.2 条件搜索(match)</h6><ul>
<li>搜索出account_number为20的文档<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;account_number&quot;: 20</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>搜索address字段中包含mill的文档<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;address&quot;: &quot;mill&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_source&quot;: [</span><br><span class="line">    &quot;address&quot;,</span><br><span class="line">    &quot;account_number&quot;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意: 对于数值类型match操作使用的是精确匹配，对于文本类型使用的是模糊匹配</p>
</blockquote>
</li>
</ul>
<hr>
<h6 id="2-2-2-3-短语匹配搜索-match-phrase"><a href="#2-2-2-3-短语匹配搜索-match-phrase" class="headerlink" title="2.2.2.3 短语匹配搜索(match_phrase)"></a>2.2.2.3 短语匹配搜索(match_phrase)</h6><ul>
<li>搜索address字段中同时包含mill和lane的<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_phrase&quot;: &#123;</span><br><span class="line">      &quot;address&quot;: &quot;mill lane&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h6 id="2-2-2-4-组合搜索-bool"><a href="#2-2-2-4-组合搜索-bool" class="headerlink" title="2.2.2.4 组合搜索(bool)"></a>2.2.2.4 组合搜索(bool)</h6><ul>
<li>同时满足(must)</li>
<li><ul>
<li>搜索address字段中同时包含mill和lane的文档<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123; &quot;match&quot;: &#123; &quot;address&quot;: &quot;mill&quot; &#125; &#125;,</span><br><span class="line">        &#123; &quot;match&quot;: &#123; &quot;address&quot;: &quot;lane&quot; &#125; &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>满足其中任意一个(should)</li>
<li><ul>
<li>搜索address字段中包含mill或者lane的文档<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;should&quot;: [</span><br><span class="line">        &#123; &quot;match&quot;: &#123; &quot;address&quot;: &quot;mill&quot; &#125; &#125;,</span><br><span class="line">        &#123; &quot;match&quot;: &#123; &quot;address&quot;: &quot;lane&quot; &#125; &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>同时不满足(must_not)</li>
<li><ul>
<li>搜索address字段中不包含mill且不包含lane的文档<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must_not&quot;: [</span><br><span class="line">        &#123; &quot;match&quot;: &#123; &quot;address&quot;: &quot;mill&quot; &#125; &#125;,</span><br><span class="line">        &#123; &quot;match&quot;: &#123; &quot;address&quot;: &quot;lane&quot; &#125; &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>满足其中一部分,并且不包含另一部分(组合must和must_not)</li>
<li><ul>
<li>搜索age字段等于40且state字段不包含ID的文档<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123; &quot;match&quot;: &#123; &quot;age&quot;: &quot;40&quot; &#125; &#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;must_not&quot;: [</span><br><span class="line">        &#123; &quot;match&quot;: &#123; &quot;state&quot;: &quot;ID&quot; &#125; &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<hr>
<h6 id="2-2-2-5-过滤搜索-filter"><a href="#2-2-2-5-过滤搜索-filter" class="headerlink" title="2.2.2.5 过滤搜索(filter)"></a>2.2.2.5 过滤搜索(filter)</h6><ul>
<li>过滤出balance字段在20000~30000的文档<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: &#123; &quot;match_all&quot;: &#123;&#125; &#125;,</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;range&quot;: &#123;</span><br><span class="line">          &quot;balance&quot;: &#123;</span><br><span class="line">            &quot;gte&quot;: 20000,</span><br><span class="line">            &quot;lte&quot;: 30000</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h6 id="2-2-2-6-搜索聚合-aggs"><a href="#2-2-2-6-搜索聚合-aggs" class="headerlink" title="2.2.2.6 搜索聚合(aggs)"></a>2.2.2.6 搜索聚合(aggs)</h6><ul>
<li>对state字段进行聚合,统计出相同state的文档数量<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;aggs&quot;:&#123;</span><br><span class="line">    &quot;group_by_state&quot;:&#123;</span><br><span class="line">      &quot;terms&quot;:&#123;</span><br><span class="line">        &quot;field&quot;:&quot;state.keyword&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">aggs: 分组聚合关键字</span><br><span class="line">group_by_state: 聚合条件名字,自定义</span><br><span class="line">terms : 关键字,查询某个字段里含有多个关键词的文档</span><br><span class="line">keyword: state是一个关键字类型</span><br></pre></td></tr></table></figure></li>
<li>对balance取平均值<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;size&quot;: 0, </span><br><span class="line">  &quot;aggs&quot;:&#123;</span><br><span class="line">    &quot;avg_balance&quot;:&#123;</span><br><span class="line">      &quot;avg&quot;:&#123;</span><br><span class="line">        &quot;field&quot;: &quot;balance&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>对state字段进行聚合,统计出相同state的文档数量和balance平均值<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">GET /bank/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;size&quot;: 0, </span><br><span class="line">  &quot;aggs&quot;:&#123;</span><br><span class="line">    &quot;group_by_state&quot;:&#123;</span><br><span class="line">      &quot;terms&quot;:&#123;</span><br><span class="line">        &quot;field&quot;:&quot;state.keyword&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;avg_balance&quot;:&#123;</span><br><span class="line">      &quot;avg&quot;:&#123;</span><br><span class="line">        &quot;field&quot;: &quot;balance&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p>具体ES的聚合函数请参考官方文档这里不再讲解</p>
</blockquote>
<hr>
<h2 id="第六章-ES和SpringBoot整合-Spring-data版本使用"><a href="#第六章-ES和SpringBoot整合-Spring-data版本使用" class="headerlink" title="第六章 ES和SpringBoot整合(Spring-data版本使用)"></a>第六章 ES和SpringBoot整合(Spring-data版本使用)</h2><h3 id="第1节-分词器介绍"><a href="#第1节-分词器介绍" class="headerlink" title="第1节 分词器介绍"></a>第1节 分词器介绍</h3><h4 id="1-1-分词器的作用"><a href="#1-1-分词器的作用" class="headerlink" title="1.1 分词器的作用"></a>1.1 分词器的作用</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">将原始内容进行拆分,将一段话拆分成单词或者一个一个的字,或者语义单元</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="1-2-常见分词器"><a href="#1-2-常见分词器" class="headerlink" title="1.2 常见分词器"></a>1.2 常见分词器</h4><ul>
<li>standars<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ES默认分词器,将词汇单元转成小写,取出一些停用词和标点符号,支持中文,将中文拆分成单个的字</span><br></pre></td></tr></table></figure></li>
<li>IK分词器<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">一个可以很好的支持中文,并且可以自定义的开源分词器</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="第2节-standars分词器演示-kibana工具"><a href="#第2节-standars分词器演示-kibana工具" class="headerlink" title="第2节 standars分词器演示(kibana工具)"></a>第2节 standars分词器演示(kibana工具)</h3><h4 id="2-1-演示英文"><a href="#2-1-演示英文" class="headerlink" title="2.1 演示英文"></a>2.1 演示英文</h4><ul>
<li>命令<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;standard&quot;,</span><br><span class="line">  &quot;text&quot;:&quot;Hello Java&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>结果<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">将Hello Java分成了两个词分别是hello和java,首字母都变成了小写</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot;: &quot;hello&quot;,</span><br><span class="line">      &quot;start_offset&quot;: 0,</span><br><span class="line">      &quot;end_offset&quot;: 5,</span><br><span class="line">      &quot;type&quot;: &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot;: 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot;: &quot;java&quot;,</span><br><span class="line">      &quot;start_offset&quot;: 6,</span><br><span class="line">      &quot;end_offset&quot;: 10,</span><br><span class="line">      &quot;type&quot;: &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot;: 1</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-2-演示中文"><a href="#2-2-演示中文" class="headerlink" title="2.2 演示中文"></a>2.2 演示中文</h4><ul>
<li>命令<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;standard&quot;,</span><br><span class="line">  &quot;text&quot;:&quot;我是中国人&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>结果<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot;: &quot;我&quot;,</span><br><span class="line">      &quot;start_offset&quot;: 0,</span><br><span class="line">      &quot;end_offset&quot;: 1,</span><br><span class="line">      &quot;type&quot;: &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot;: 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot;: &quot;是&quot;,</span><br><span class="line">      &quot;start_offset&quot;: 1,</span><br><span class="line">      &quot;end_offset&quot;: 2,</span><br><span class="line">      &quot;type&quot;: &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot;: 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot;: &quot;中&quot;,</span><br><span class="line">      &quot;start_offset&quot;: 2,</span><br><span class="line">      &quot;end_offset&quot;: 3,</span><br><span class="line">      &quot;type&quot;: &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot;: 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot;: &quot;国&quot;,</span><br><span class="line">      &quot;start_offset&quot;: 3,</span><br><span class="line">      &quot;end_offset&quot;: 4,</span><br><span class="line">      &quot;type&quot;: &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot;: 3</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot;: &quot;人&quot;,</span><br><span class="line">      &quot;start_offset&quot;: 4,</span><br><span class="line">      &quot;end_offset&quot;: 5,</span><br><span class="line">      &quot;type&quot;: &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot;: 4</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="第3节-ik分词器安装和使用"><a href="#第3节-ik分词器安装和使用" class="headerlink" title="第3节 ik分词器安装和使用"></a>第3节 ik分词器安装和使用</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">medcl/elasticsearch-analysis-ik分词器是当前对中文支持最好的分词器</span><br></pre></td></tr></table></figure>
<ul>
<li>IK分词器地址<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/medcl/elasticsearch-analysis-ik/archive/v6.3.2.zip</span><br><span class="line"></span><br><span class="line">下载的分词器一定要和当前安装的ES版本相同</span><br></pre></td></tr></table></figure></li>
<li>安装步骤<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. 将下载的分词器压缩包复制到我们的es的安装目录D:\soft\elasticsearch-6.3.2\plugins插件目录下</span><br><span class="line">3. 将elasticsearch-analysis-ik解压</span><br><span class="line">4. 重启ES服务</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="第4节-ik分词器演示-kibana工具"><a href="#第4节-ik分词器演示-kibana工具" class="headerlink" title="第4节 ik分词器演示(kibana工具)"></a>第4节 ik分词器演示(kibana工具)</h3><ul>
<li>命令<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;ik_smart&quot;,</span><br><span class="line">  &quot;text&quot;:&quot;我是中国人&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span><br><span class="line">  &quot;text&quot;:&quot;我是中国人&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>返回效果<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">ik_smart分词器效果</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot;: &quot;我&quot;,</span><br><span class="line">      &quot;start_offset&quot;: 0,</span><br><span class="line">      &quot;end_offset&quot;: 1,</span><br><span class="line">      &quot;type&quot;: &quot;CN_CHAR&quot;,</span><br><span class="line">      &quot;position&quot;: 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot;: &quot;是&quot;,</span><br><span class="line">      &quot;start_offset&quot;: 1,</span><br><span class="line">      &quot;end_offset&quot;: 2,</span><br><span class="line">      &quot;type&quot;: &quot;CN_CHAR&quot;,</span><br><span class="line">      &quot;position&quot;: 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot;: &quot;中国人&quot;,</span><br><span class="line">      &quot;start_offset&quot;: 2,</span><br><span class="line">      &quot;end_offset&quot;: 5,</span><br><span class="line">      &quot;type&quot;: &quot;CN_WORD&quot;,</span><br><span class="line">      &quot;position&quot;: 2</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">---------------------</span><br><span class="line"></span><br><span class="line">ik_max_word分词器效果</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot;: &quot;我&quot;,</span><br><span class="line">      &quot;start_offset&quot;: 0,</span><br><span class="line">      &quot;end_offset&quot;: 1,</span><br><span class="line">      &quot;type&quot;: &quot;CN_CHAR&quot;,</span><br><span class="line">      &quot;position&quot;: 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot;: &quot;是&quot;,</span><br><span class="line">      &quot;start_offset&quot;: 1,</span><br><span class="line">      &quot;end_offset&quot;: 2,</span><br><span class="line">      &quot;type&quot;: &quot;CN_CHAR&quot;,</span><br><span class="line">      &quot;position&quot;: 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot;: &quot;中国人&quot;,</span><br><span class="line">      &quot;start_offset&quot;: 2,</span><br><span class="line">      &quot;end_offset&quot;: 5,</span><br><span class="line">      &quot;type&quot;: &quot;CN_WORD&quot;,</span><br><span class="line">      &quot;position&quot;: 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot;: &quot;中国&quot;,</span><br><span class="line">      &quot;start_offset&quot;: 2,</span><br><span class="line">      &quot;end_offset&quot;: 4,</span><br><span class="line">      &quot;type&quot;: &quot;CN_WORD&quot;,</span><br><span class="line">      &quot;position&quot;: 3</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot;: &quot;国人&quot;,</span><br><span class="line">      &quot;start_offset&quot;: 3,</span><br><span class="line">      &quot;end_offset&quot;: 5,</span><br><span class="line">      &quot;type&quot;: &quot;CN_WORD&quot;,</span><br><span class="line">      &quot;position&quot;: 4</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="第5节-ES和SpringBoot整合"><a href="#第5节-ES和SpringBoot整合" class="headerlink" title="第5节 ES和SpringBoot整合"></a>第5节 ES和SpringBoot整合</h3><h4 id="5-1-创建SpringBoot项目"><a href="#5-1-创建SpringBoot项目" class="headerlink" title="5.1 创建SpringBoot项目"></a>5.1 创建SpringBoot项目</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">添加依赖,依赖在springboot-data中</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-data-elasticsearch&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<center>

<img src="https://note.youdao.com/yws/api/personal/file/WEBf368ecdd8daad54090d49c410f198080?method=download&shareKey=b8d107a550419db9195541167c95628d">

</center>

<h4 id="5-2-配置"><a href="#5-2-配置" class="headerlink" title="5.2 配置"></a>5.2 配置</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 设置ES的节点地址</span><br><span class="line"># spring.data.elasticsearch.cluster-nodes=127.0.0.1:9300,127.0.0.1:9301,127.0.0.1:9302</span><br><span class="line">spring.data.elasticsearch.cluster-nodes=127.0.0.1:9300</span><br><span class="line"># es集群名称</span><br><span class="line">spring.data.elasticsearch.cluster-name=elasticsearch</span><br></pre></td></tr></table></figure>
<h4 id="5-3-常见的操作"><a href="#5-3-常见的操作" class="headerlink" title="5.3 常见的操作"></a>5.3 常见的操作</h4><h5 id="5-3-1-映射ES文档的实体类"><a href="#5-3-1-映射ES文档的实体类" class="headerlink" title="5.3.1 映射ES文档的实体类"></a>5.3.1 映射ES文档的实体类</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @Author 枫桥夜泊1990</span><br><span class="line"> * @BLOG https://hd1611756908.github.io/</span><br><span class="line"> * @BSITE https://space.bilibili.com/514155929/</span><br><span class="line"> * @DATE 2020/8/17</span><br><span class="line"> * Document: 设置文档</span><br><span class="line"> * indexName：设置索引</span><br><span class="line"> * type： 设置类型</span><br><span class="line"> * shards: 设置分片</span><br><span class="line"> * replicas: 设置副本</span><br><span class="line"> */</span><br><span class="line">@Document(indexName = &quot;bank&quot;,type = &quot;account&quot;,shards = 5,replicas = 1)</span><br><span class="line">public class EsAccount &#123;</span><br><span class="line"></span><br><span class="line">    @Id</span><br><span class="line">    private Long id;</span><br><span class="line">    @Field(type = FieldType.Long)</span><br><span class="line">    private Long account_number;</span><br><span class="line">    @Field(type = FieldType.Text) //是有IK分词器(一定要安装IK分词器)</span><br><span class="line">    private String firstname;</span><br><span class="line">    @Field(type = FieldType.Text)</span><br><span class="line">    private String address;</span><br><span class="line">    @Field(type = FieldType.Text)</span><br><span class="line">    private String gender;</span><br><span class="line">    @Field(type = FieldType.Text)</span><br><span class="line">    private String city;</span><br><span class="line">    @Field(type = FieldType.Long)</span><br><span class="line">    private Long balance;</span><br><span class="line">    @Field(type = FieldType.Text)</span><br><span class="line">    private String lastname;</span><br><span class="line">    @Field(type = FieldType.Text)</span><br><span class="line">    private String employer;</span><br><span class="line">    @Field(type = FieldType.Text)</span><br><span class="line">    private String state;</span><br><span class="line">    @Field(type = FieldType.Long)</span><br><span class="line">    private Long age;</span><br><span class="line">    @Field(type = FieldType.Text)</span><br><span class="line">    private String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="5-3-2-操作ES的接口"><a href="#5-3-2-操作ES的接口" class="headerlink" title="5.3.2 操作ES的接口"></a>5.3.2 操作ES的接口</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">public interface EsAccountRepository extends ElasticsearchRepository&lt;EsAccount,Long&gt; &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据名称查询</span><br><span class="line">     * 方法名字不能随便乱起</span><br><span class="line">     */</span><br><span class="line">    List&lt;EsAccount&gt; findByLastname(String lastname);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据地址查询</span><br><span class="line">     * 方法名字不能随便乱起</span><br><span class="line">     */</span><br><span class="line">    List&lt;EsAccount&gt; findByAddress(String address);</span><br><span class="line">    /**</span><br><span class="line">     * 根据名称删除</span><br><span class="line">     * 方法名字不能随便乱起</span><br><span class="line">     */</span><br><span class="line">    void deleteByFirstname(String firstname);</span><br><span class="line">    /**</span><br><span class="line">     * 根据地址查询,并且分页</span><br><span class="line">     * 方法名字不能随便乱起</span><br><span class="line">     */</span><br><span class="line">    Page&lt;EsAccount&gt; findByAddress(String address, Pageable pageable);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="5-3-3-单元测试操作"><a href="#5-3-3-单元测试操作" class="headerlink" title="5.3.3 单元测试操作"></a>5.3.3 单元测试操作</h5><ul>
<li>常见操作<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @Author 枫桥夜泊1990</span><br><span class="line"> * @BLOG https://hd1611756908.github.io/</span><br><span class="line"> * @BSITE https://space.bilibili.com/514155929/</span><br><span class="line"> * @DATE 2020/8/17</span><br><span class="line"> */</span><br><span class="line">public class EsAccountRepositoryTest extends SpringbootEs01ApplicationTests &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private EsAccountRepository esAccountRepository;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 测试findAll</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void findAll1()&#123;</span><br><span class="line">        Iterable&lt;EsAccount&gt; esAccounts = esAccountRepository.findAll();</span><br><span class="line">        //esAccounts.forEach(System.out::println);</span><br><span class="line">        //esAccounts.forEach((x)-&gt;&#123;System.out.println(x);&#125;);</span><br><span class="line">        Iterator&lt;EsAccount&gt; iterator = esAccounts.iterator();</span><br><span class="line">        while (iterator.hasNext())&#123;</span><br><span class="line">            System.out.println(iterator.next());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * 测试添加一条数据</span><br><span class="line">     * 更新数据,更新和添加主要判断是否有id</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void saveAccount()&#123;</span><br><span class="line">        EsAccount account = new EsAccount();</span><br><span class="line">        account.setAccount_number(4570L);</span><br><span class="line">        account.setAddress(&quot;北京&quot;);</span><br><span class="line">        account.setAge(18L);</span><br><span class="line">        account.setBalance(1000000L);</span><br><span class="line">        account.setCity(&quot;中国&quot;);</span><br><span class="line">        account.setEmail(&quot;123@.com&quot;);</span><br><span class="line">        account.setEmployer(&quot;李雷&quot;);</span><br><span class="line">        account.setFirstname(&quot;李&quot;);</span><br><span class="line">        account.setGender(&quot;男&quot;);</span><br><span class="line">        account.setId(4570L);</span><br><span class="line">        account.setLastname(&quot;李雷&quot;);</span><br><span class="line">        account.setState(&quot;NL&quot;);</span><br><span class="line">        esAccountRepository.save(account);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据ID查询account</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void findAccountById()&#123;</span><br><span class="line">        Optional&lt;EsAccount&gt; esAccount = esAccountRepository.findById(4570L);</span><br><span class="line">        System.out.println(esAccount.get());</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * 根据ID删除</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void deleteAccount()&#123;</span><br><span class="line">        esAccountRepository.deleteById(4570L);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 更新</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void updateAccount()&#123;</span><br><span class="line"></span><br><span class="line">        Optional&lt;EsAccount&gt; esAccount = esAccountRepository.findById(456L);</span><br><span class="line">        EsAccount account = esAccount.get();</span><br><span class="line">        account.setLastname(&quot;李雷super&quot;);</span><br><span class="line">        esAccountRepository.save(account);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据Lastname查询（模糊查询）</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void findByLastname()&#123;</span><br><span class="line">        List&lt;EsAccount&gt; accountList = esAccountRepository.findByLastname(&quot;李雷&quot;);</span><br><span class="line">        System.out.println(accountList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据地址查询（模糊查询）</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void findByAddress()&#123;</span><br><span class="line">        List&lt;EsAccount&gt; accounts = esAccountRepository.findByAddress(&quot;京&quot;);</span><br><span class="line">        System.out.println(accounts);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 分页查询</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void findPage()&#123;</span><br><span class="line">        Pageable p = PageRequest.of(0, 5);</span><br><span class="line">        Page&lt;EsAccount&gt; accounts = esAccountRepository.findAll(p);</span><br><span class="line">        for (EsAccount account : accounts) &#123;</span><br><span class="line">            System.out.println(account);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 排序分页查询</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void findPageMult()&#123;</span><br><span class="line">        Sort sort = Sort.by(Sort.Direction.DESC, &quot;account_number&quot;);</span><br><span class="line">        Pageable p = PageRequest.of(0, 5, sort);</span><br><span class="line">        Page&lt;EsAccount&gt; accounts = esAccountRepository.findByAddress(&quot;Place&quot;, p);</span><br><span class="line">        for (EsAccount account : accounts) &#123;</span><br><span class="line">            System.out.println(account);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 复杂查询,采用search方法</span><br><span class="line">     * 构建条件查询 使用match语法</span><br><span class="line">     * 过滤查询</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testMatch01()&#123;</span><br><span class="line">        //单个条件</span><br><span class="line">        // QueryBuilder query = QueryBuilders.matchQuery(&quot;account_number&quot;, 20);</span><br><span class="line">        //多个条件</span><br><span class="line">        NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">        NativeSearchQueryBuilder queryBuilder = builder</span><br><span class="line">                            .withQuery(QueryBuilders.matchQuery(&quot;account_number&quot;, 20))</span><br><span class="line">                            .withQuery(QueryBuilders.matchQuery(&quot;firstname&quot;,&quot;Elinor&quot;));</span><br><span class="line">        NativeSearchQuery build = queryBuilder.build();</span><br><span class="line">        Iterable&lt;EsAccount&gt; accounts = esAccountRepository.search(build);</span><br><span class="line">        for (EsAccount account : accounts) &#123;</span><br><span class="line">            System.out.println(account);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 复杂查询,采用search方法</span><br><span class="line">     * 构建条件查询 使用match语法</span><br><span class="line">     * 短语匹配搜索</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testMatchPhrase()&#123;</span><br><span class="line"></span><br><span class="line">        NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">        NativeSearchQueryBuilder queryBuilder = builder.withQuery(QueryBuilders.matchPhraseQuery(&quot;address&quot;, &quot;mill lane&quot;));</span><br><span class="line">        NativeSearchQuery searchQuery = queryBuilder.build();</span><br><span class="line">        Page&lt;EsAccount&gt; accountPage = esAccountRepository.search(searchQuery);</span><br><span class="line">        //accountPage.forEach(System.out::println);</span><br><span class="line">        //accountPage.forEach((x)-&gt;&#123;System.out.println(x);&#125;);</span><br><span class="line">        //获取迭代器</span><br><span class="line">        Iterator&lt;EsAccount&gt; iterator = accountPage.iterator();</span><br><span class="line">        while(iterator.hasNext())&#123;</span><br><span class="line">            System.out.println(iterator.next());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 组合搜索(bool)</span><br><span class="line">     * 同时满足(must)</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testMust()&#123;</span><br><span class="line"></span><br><span class="line">        NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">        builder.withQuery(QueryBuilders.boolQuery().must(QueryBuilders.matchQuery(&quot;address&quot;,&quot;mill&quot;)).must(QueryBuilders.matchQuery(&quot;address&quot;,&quot;lane&quot;)));</span><br><span class="line">        NativeSearchQuery query = builder.build();</span><br><span class="line">        Page&lt;EsAccount&gt; accounts = esAccountRepository.search(query);</span><br><span class="line">        for (EsAccount account : accounts) &#123;</span><br><span class="line">            System.out.println(account);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 满足其中任意一个(should)</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testShould()&#123;</span><br><span class="line"></span><br><span class="line">        NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">        builder.withQuery(QueryBuilders.boolQuery().should(QueryBuilders.matchQuery(&quot;address&quot;,&quot;lane&quot;)).should(QueryBuilders.matchQuery(&quot;address&quot;,&quot;mill&quot;)));</span><br><span class="line">        NativeSearchQuery searchQuery = builder.build();</span><br><span class="line">        Page&lt;EsAccount&gt; accounts = esAccountRepository.search(searchQuery);</span><br><span class="line">        for (EsAccount account : accounts) &#123;</span><br><span class="line">            System.out.println(account);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * 同时不满足 must_not</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testMustNot()&#123;</span><br><span class="line"></span><br><span class="line">        NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">        builder.withQuery(QueryBuilders.boolQuery().mustNot(QueryBuilders.matchQuery(&quot;address&quot;,&quot;mill&quot;)).mustNot(QueryBuilders.matchQuery(&quot;address&quot;,&quot;lane&quot;)));</span><br><span class="line">        NativeSearchQuery query = builder.build();</span><br><span class="line">        Page&lt;EsAccount&gt; search = esAccountRepository.search(query);</span><br><span class="line">        for (EsAccount esAccount : search) &#123;</span><br><span class="line">            System.out.println(esAccount);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 满足其中一部分,并且不包含另一部分(组合must和must_not)</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testMustAndNotMust()&#123;</span><br><span class="line"></span><br><span class="line">        NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">        builder.withQuery(QueryBuilders.boolQuery().mustNot(QueryBuilders.matchQuery(&quot;state&quot;,&quot;ID&quot;)).must(QueryBuilders.matchQuery(&quot;age&quot;,&quot;40&quot;)));</span><br><span class="line">        NativeSearchQuery query = builder.build();</span><br><span class="line">        Page&lt;EsAccount&gt; accounts = esAccountRepository.search(query);</span><br><span class="line">        for (EsAccount account : accounts) &#123;</span><br><span class="line">            System.out.println(account);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 过滤搜索 filter</span><br><span class="line">     * 过滤出balance字段在20000~30000的文档</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testFilter()&#123;</span><br><span class="line">        NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">        builder.withFilter(QueryBuilders.boolQuery().filter(QueryBuilders.rangeQuery(&quot;balance&quot;).gte(20000).lte(30000)));</span><br><span class="line">        NativeSearchQuery query = builder.build();</span><br><span class="line">        Page&lt;EsAccount&gt; accounts = esAccountRepository.search(query);</span><br><span class="line">        for (EsAccount account : accounts) &#123;</span><br><span class="line">            System.out.println(account);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>分组聚合<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Elasticsearch有一个功能叫做聚合(aggregations),它允许你在数据上生成复杂的分析统计。它很像SQL中的 GROUP BY 但是功能更强大.</span><br><span class="line"></span><br><span class="line">Elasticsearch的聚合中声明了两个概念如下:</span><br><span class="line">   -- Buckets(桶)：满足某个条件的文档集合。</span><br><span class="line">   -- Metrics(指标)：为某个桶中的文档计算得到的统计信息</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">我们可以把类似于数据库中的COUNT(*) 看成一个指标</span><br><span class="line">将 GROUP BY 看成一个桶</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">@Autowired</span><br><span class="line">private ElasticsearchTemplate elasticsearchTemplate;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 分组聚合  ElasticsearchTemplate</span><br><span class="line"> * 单个分组聚合</span><br><span class="line"> * 对state字段进行聚合，统计出相同state的文档数量</span><br><span class="line"> */</span><br><span class="line">@Test</span><br><span class="line">public void group01()&#123;</span><br><span class="line"></span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    //统计state字段相同数据出现的次数</span><br><span class="line">    TermsAggregationBuilder field = AggregationBuilders.terms(&quot;group_by_state&quot;).field(&quot;state.keyword&quot;);</span><br><span class="line"></span><br><span class="line">    //查询全部</span><br><span class="line">    builder.withQuery(QueryBuilders.matchAllQuery());</span><br><span class="line">    //添加聚合条件</span><br><span class="line">    builder.addAggregation(field);</span><br><span class="line">    //构建</span><br><span class="line">    NativeSearchQuery query = builder.build();</span><br><span class="line">    //查询,采用ElasticsearchTemplate</span><br><span class="line">    Aggregations aggregations = elasticsearchTemplate.query(query, new ResultsExtractor&lt;Aggregations&gt;() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public Aggregations extract(SearchResponse response) &#123;</span><br><span class="line">            return response.getAggregations();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    //转换成map集合</span><br><span class="line">    Map&lt;String, Aggregation&gt; aggregationMap = aggregations.asMap();</span><br><span class="line">    //获取响应的聚合子类group_by_state</span><br><span class="line">    StringTerms groupByState = (StringTerms) aggregationMap.get(&quot;group_by_state&quot;);</span><br><span class="line">    //获取所有的桶</span><br><span class="line">    List&lt;StringTerms.Bucket&gt; buckets = groupByState.getBuckets();</span><br><span class="line">    Iterator&lt;StringTerms.Bucket&gt; iterator = buckets.iterator();</span><br><span class="line">    while (iterator.hasNext())&#123;</span><br><span class="line">        StringTerms.Bucket bucket = iterator.next();</span><br><span class="line">        System.out.println(bucket.getKeyAsString());</span><br><span class="line">        System.out.println(bucket.getDocCount());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 分组聚合  ElasticsearchTemplate</span><br><span class="line"> * 多个分组聚合</span><br><span class="line"> * 统计出相同state的文档数量，再统计出balance的平均值</span><br><span class="line"> */</span><br><span class="line">@Test</span><br><span class="line">public void group02()&#123;</span><br><span class="line"></span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    //统计state字段相同数据出现的次数</span><br><span class="line">    TermsAggregationBuilder field = AggregationBuilders.terms(&quot;group_by_state&quot;).field(&quot;state.keyword&quot;);</span><br><span class="line">    //统计出balance的平均值</span><br><span class="line">    AvgAggregationBuilder field2 = AggregationBuilders.avg(&quot;avg_balance&quot;).field(&quot;balance&quot;);</span><br><span class="line"></span><br><span class="line">    //查询全部</span><br><span class="line">    builder.withQuery(QueryBuilders.matchAllQuery());</span><br><span class="line">    //添加聚合条件</span><br><span class="line">    builder.addAggregation(field);</span><br><span class="line">    builder.addAggregation(field2);</span><br><span class="line">    //构建</span><br><span class="line">    NativeSearchQuery query = builder.build();</span><br><span class="line">    //查询,采用ElasticsearchTemplate</span><br><span class="line">    Aggregations aggregations = elasticsearchTemplate.query(query, new ResultsExtractor&lt;Aggregations&gt;() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public Aggregations extract(SearchResponse response) &#123;</span><br><span class="line">            return response.getAggregations();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    //转换成map集合</span><br><span class="line">    Map&lt;String, Aggregation&gt; aggregationMap = aggregations.asMap();</span><br><span class="line">    //获取响应的聚合子类group_by_state</span><br><span class="line">    StringTerms groupByState = (StringTerms) aggregationMap.get(&quot;group_by_state&quot;);</span><br><span class="line">    //获取响应的聚合子类avg_balance</span><br><span class="line">    InternalAvg avgBalance = (InternalAvg) aggregationMap.get(&quot;avg_balance&quot;);</span><br><span class="line">    //获取所有的桶</span><br><span class="line">    List&lt;StringTerms.Bucket&gt; buckets = groupByState.getBuckets();</span><br><span class="line">    Iterator&lt;StringTerms.Bucket&gt; iterator = buckets.iterator();</span><br><span class="line">    while (iterator.hasNext())&#123;</span><br><span class="line">        StringTerms.Bucket bucket = iterator.next();</span><br><span class="line">        System.out.println(bucket.getKeyAsString());</span><br><span class="line">        System.out.println(bucket.getDocCount());</span><br><span class="line">    &#125;</span><br><span class="line">    //获取指标</span><br><span class="line">    double value = avgBalance.getValue();</span><br><span class="line">    System.out.println(&quot;===&quot;+value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h2 id="第七章-ES和MYSQL数据同步"><a href="#第七章-ES和MYSQL数据同步" class="headerlink" title="第七章 ES和MYSQL数据同步"></a>第七章 ES和MYSQL数据同步</h2><h3 id="第1节-logstash简介"><a href="#第1节-logstash简介" class="headerlink" title="第1节 logstash简介"></a>第1节 logstash简介</h3><p style="font-size:13px;">

<p>Logstash是一款开源的数据收集引擎，具备实时管道处理能力。简单来说，logstash作为数据源与数据存储分析工具之间的桥梁，结合ElasticSearch以及Kibana，能够极大方便数据的处理与分析。通过200多个插件，logstash可以接受几乎各种各样的数据。包括日志、网络请求、关系型数据库、传感器或物联网等等</p>
</p>

<center>

<img src="https://note.youdao.com/yws/api/personal/file/WEB324520b8cc6527b409bc9eae1013cf89?method=download&shareKey=63c09a87e26f0185db22078768d8859b">

</center>

<hr>
<h3 id="第2节-logstash下载-6-3-2"><a href="#第2节-logstash下载-6-3-2" class="headerlink" title="第2节 logstash下载(6.3.2)"></a>第2节 logstash下载(6.3.2)</h3><ul>
<li>官网地址<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.elastic.co/cn/downloads/logstash</span><br></pre></td></tr></table></figure></li>
<li>华为镜像站<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://mirrors.huaweicloud.com/logstash/</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="第3节-logstash配置-简单配置-单表-x2F-多表"><a href="#第3节-logstash配置-简单配置-单表-x2F-多表" class="headerlink" title="第3节 logstash配置(简单配置-单表&#x2F;多表)"></a>第3节 logstash配置(简单配置-单表&#x2F;多表)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">logstash工作时，主要设置3个部分的工作属性。</span><br><span class="line">input：设置数据来源</span><br><span class="line">filter：可以对数据进行一定的加工处理过滤，但是不建议做复杂的处理逻辑。这个步骤不是必须的</span><br><span class="line">output：设置输出目标</span><br></pre></td></tr></table></figure>
<ul>
<li><p>安装&#x2F;配置步骤(使用单个表生成索引)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. 将下载的logstash-6.3.2.zip文件解压到指定位置</span><br><span class="line">2. 创建一个配置文件名字自定义,我命名为 mysql.conf,将自定义配置文件放到指定位置(我放到了D:\soft\logstash-6.3.2\config文件夹下)</span><br><span class="line">3. 在mysql.conf中添加配置信息</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">input&#123;</span><br><span class="line">	jdbc&#123;</span><br><span class="line">		# 数据库驱动地址</span><br><span class="line">		jdbc_driver_library =&gt; &quot;D:\\soft\\logstash-6.3.2\\lib\\mysql-connector-java-5.1.47.jar&quot; </span><br><span class="line">		# 数据库驱动类名</span><br><span class="line">		jdbc_driver_class =&gt; &quot;com.mysql.jdbc.Driver&quot;</span><br><span class="line">		# 数据库连接地址</span><br><span class="line">		jdbc_connection_string =&gt; &quot;jdbc:mysql://127.0.0.1:3306/gn_oa&quot;</span><br><span class="line">		# 数据库用户名</span><br><span class="line">		jdbc_user =&gt; &quot;root&quot;</span><br><span class="line">		# 数据库密码</span><br><span class="line">		jdbc_password =&gt; &quot;root&quot;</span><br><span class="line">		# 定时任务</span><br><span class="line">		schedule =&gt; &quot;* * * * *&quot;</span><br><span class="line">		# 生成索引的数据来源</span><br><span class="line">		statement =&gt; &quot;SELECT * FROM department&quot;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">output&#123;</span><br><span class="line">	elasticsearch&#123;</span><br><span class="line">		# 集群地址</span><br><span class="line">		hosts =&gt; [&quot;127.0.0.1:9200&quot;,&quot;127.0.0.1:9201&quot;,&quot;127.0.0.1:9202&quot;]</span><br><span class="line">		# 索引名称</span><br><span class="line">		index =&gt; &quot;department&quot;</span><br><span class="line">		# 生成根据dept_id,生成ES的 _id</span><br><span class="line">		document_id =&gt; &quot;%&#123;dept_id&#125;&quot;</span><br><span class="line">		# 类型</span><br><span class="line">		document_type =&gt; &quot;dept_doc&quot;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">4. 启动logstash服务,使用我们自定义的配置启动</span><br><span class="line">    -- 使用cmd命令行定位到当前logstash目录的bin目录下使用命令为: logstash -f ../config/mysql.conf 启动服务 </span><br><span class="line">5. 等待索引创建完成(这种方式为全量方式)</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装&#x2F;配置步骤(使用多张表生成索引)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">input&#123;</span><br><span class="line">	# 第1张表</span><br><span class="line">	jdbc&#123;</span><br><span class="line">		# 设置当前jdbc的type</span><br><span class="line">		type =&gt; &quot;department&quot;</span><br><span class="line">		# 数据库驱动地址</span><br><span class="line">		jdbc_driver_library =&gt; &quot;D:\\soft\\logstash-6.3.2\\lib\\mysql-connector-java-5.1.47.jar&quot; </span><br><span class="line">		# 数据库驱动类名</span><br><span class="line">		jdbc_driver_class =&gt; &quot;com.mysql.jdbc.Driver&quot;</span><br><span class="line">		# 数据库连接地址</span><br><span class="line">		jdbc_connection_string =&gt; &quot;jdbc:mysql://127.0.0.1:3306/gn_oa&quot;</span><br><span class="line">		# 数据库用户名</span><br><span class="line">		jdbc_user =&gt; &quot;root&quot;</span><br><span class="line">		# 数据库密码</span><br><span class="line">		jdbc_password =&gt; &quot;root&quot;</span><br><span class="line">		# 定时任务</span><br><span class="line">		schedule =&gt; &quot;* * * * *&quot;</span><br><span class="line">		# 生成索引的数据来源</span><br><span class="line">		statement =&gt; &quot;SELECT * FROM department&quot;</span><br><span class="line">	&#125;</span><br><span class="line">	# 第2张表</span><br><span class="line">	jdbc&#123;</span><br><span class="line">		# 设置当前jdbc的type</span><br><span class="line">		type =&gt; &quot;student&quot;</span><br><span class="line">		# 数据库驱动地址</span><br><span class="line">		jdbc_driver_library =&gt; &quot;D:\\soft\\logstash-6.3.2\\lib\\mysql-connector-java-5.1.47.jar&quot; </span><br><span class="line">		# 数据库驱动类名</span><br><span class="line">		jdbc_driver_class =&gt; &quot;com.mysql.jdbc.Driver&quot;</span><br><span class="line">		# 数据库连接地址</span><br><span class="line">		jdbc_connection_string =&gt; &quot;jdbc:mysql://127.0.0.1:3306/gn_oa&quot;</span><br><span class="line">		# 数据库用户名</span><br><span class="line">		jdbc_user =&gt; &quot;root&quot;</span><br><span class="line">		# 数据库密码</span><br><span class="line">		jdbc_password =&gt; &quot;root&quot;</span><br><span class="line">		# 定时任务</span><br><span class="line">		schedule =&gt; &quot;* * * * *&quot;</span><br><span class="line">		# 生成索引的数据来源</span><br><span class="line">		statement =&gt; &quot;SELECT * FROM student&quot;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">output&#123;</span><br><span class="line"></span><br><span class="line">	# 根据jdbc中的type值指定输入的jdbc对应的输出为哪一个elasticsearch</span><br><span class="line">	</span><br><span class="line">	if[type]==&quot;department&quot;&#123;</span><br><span class="line"></span><br><span class="line">		elasticsearch&#123;</span><br><span class="line">			# 集群地址</span><br><span class="line">			hosts =&gt; [&quot;127.0.0.1:9200&quot;,&quot;127.0.0.1:9201&quot;,&quot;127.0.0.1:9202&quot;]</span><br><span class="line">			# 索引名称</span><br><span class="line">			index =&gt; &quot;department&quot;</span><br><span class="line">			# 生成根据dept_id,生成ES的 _id</span><br><span class="line">			document_id =&gt; &quot;%&#123;dept_id&#125;&quot;</span><br><span class="line">			# 类型</span><br><span class="line">			document_type =&gt; &quot;dept_doc&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	if[type]==&quot;student&quot;&#123;</span><br><span class="line">		</span><br><span class="line">		elasticsearch&#123;</span><br><span class="line">			# 集群地址</span><br><span class="line">			hosts =&gt; [&quot;127.0.0.1:9200&quot;,&quot;127.0.0.1:9201&quot;,&quot;127.0.0.1:9202&quot;]</span><br><span class="line">			# 索引名称</span><br><span class="line">			index =&gt; &quot;student&quot;</span><br><span class="line">			# 生成根据student_id,生成ES的 _id</span><br><span class="line">			document_id =&gt; &quot;%&#123;student_id&#125;&quot;</span><br><span class="line">			# 类型</span><br><span class="line">			document_type =&gt; &quot;student_doc&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="第4节-logstash配置-其他配置"><a href="#第4节-logstash配置-其他配置" class="headerlink" title="第4节 logstash配置(其他配置)"></a>第4节 logstash配置(其他配置)</h3><ul>
<li>官网配置地址<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.elastic.co/guide/en/logstash/6.3/plugins-inputs-jdbc.html</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h4 id="4-1-使用时间字段进行追踪-一般使用更新时间字段"><a href="#4-1-使用时间字段进行追踪-一般使用更新时间字段" class="headerlink" title="4.1 使用时间字段进行追踪(一般使用更新时间字段)"></a>4.1 使用时间字段进行追踪(一般使用更新时间字段)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在阿里巴巴嵩山版手册中强调,任何数据库表都必须有创建时间和更新时间字段,都是datetime类型,也就是保存时间为年月日时分秒</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">input&#123;</span><br><span class="line">	# 第1张表</span><br><span class="line">	jdbc&#123;</span><br><span class="line">		# 设置当前jdbc的type</span><br><span class="line">		type =&gt; &quot;department&quot;</span><br><span class="line">		# 数据库驱动地址</span><br><span class="line">		jdbc_driver_library =&gt; &quot;D:\\soft\\logstash-6.3.2\\lib\\mysql-connector-java-5.1.47.jar&quot; </span><br><span class="line">		# 数据库驱动类名</span><br><span class="line">		jdbc_driver_class =&gt; &quot;com.mysql.jdbc.Driver&quot;</span><br><span class="line">		# 数据库连接地址</span><br><span class="line">		jdbc_connection_string =&gt; &quot;jdbc:mysql://127.0.0.1:3306/gn_oa&quot;</span><br><span class="line">		# 数据库用户名</span><br><span class="line">		jdbc_user =&gt; &quot;root&quot;</span><br><span class="line">		# 数据库密码</span><br><span class="line">		jdbc_password =&gt; &quot;root&quot;</span><br><span class="line">		# 定时任务,一分钟同步一次</span><br><span class="line">		schedule =&gt; &quot;* * * * *&quot;</span><br><span class="line">		# 如果sql语句使用sql_last_value属性要设置use_column_value为true,并且指定tracking_column属性,指定哪一列</span><br><span class="line">		use_column_value =&gt; true</span><br><span class="line">		# 指定sql_last_value参数使用哪一列</span><br><span class="line">		tracking_column =&gt; &quot;create_time&quot;</span><br><span class="line">		# 设置tracking_column属性名保存的状态</span><br><span class="line">		last_run_metadata_path =&gt; &quot;D:\\soft\\logstash-6.3.2\\a\\a.txt&quot;</span><br><span class="line">		# 是否保留前一次的运行状态,如果不保留下次重启服务器所以会被重新创建</span><br><span class="line">		clean_run =&gt; false</span><br><span class="line">		# 设置时间戳</span><br><span class="line">		tracking_column_type =&gt; &quot;timestamp&quot;</span><br><span class="line">		# 生成索引的数据来源</span><br><span class="line">		statement =&gt; &quot;SELECT * FROM department WHERE create_time &gt; :sql_last_value AND create_time &lt; now() ORDER BY create_time desc&quot;</span><br><span class="line">	&#125;</span><br><span class="line">	# 第2张表</span><br><span class="line">	jdbc&#123;</span><br><span class="line">		# 设置当前jdbc的type</span><br><span class="line">		type =&gt; &quot;student&quot;</span><br><span class="line">		# 数据库驱动地址</span><br><span class="line">		jdbc_driver_library =&gt; &quot;D:\\soft\\logstash-6.3.2\\lib\\mysql-connector-java-5.1.47.jar&quot; </span><br><span class="line">		# 数据库驱动类名</span><br><span class="line">		jdbc_driver_class =&gt; &quot;com.mysql.jdbc.Driver&quot;</span><br><span class="line">		# 数据库连接地址</span><br><span class="line">		jdbc_connection_string =&gt; &quot;jdbc:mysql://127.0.0.1:3306/gn_oa&quot;</span><br><span class="line">		# 数据库用户名</span><br><span class="line">		jdbc_user =&gt; &quot;root&quot;</span><br><span class="line">		# 数据库密码</span><br><span class="line">		jdbc_password =&gt; &quot;root&quot;</span><br><span class="line">		# 定时任务,一分钟同步一次</span><br><span class="line">		schedule =&gt; &quot;* * * * *&quot;</span><br><span class="line">		# 如果sql语句使用sql_last_value属性要设置use_column_value为true</span><br><span class="line">		use_column_value =&gt; true</span><br><span class="line">		# 指定sql_last_value参数使用哪一列</span><br><span class="line">		tracking_column =&gt; &quot;create_time&quot;</span><br><span class="line">		# 设置tracking_column属性名保存的状态</span><br><span class="line">		last_run_metadata_path =&gt; &quot;D:\\soft\\logstash-6.3.2\\b\\b.txt&quot;</span><br><span class="line">		# 是否保留前一次的运行状态,如果不保留下次重启服务器所以会被重新创建</span><br><span class="line">		clean_run =&gt; false</span><br><span class="line">		# 设置时间戳</span><br><span class="line">		tracking_column_type =&gt; &quot;timestamp&quot;</span><br><span class="line">		# 生成索引的数据来源</span><br><span class="line">		statement =&gt; &quot;SELECT * FROM student WHERE create_time &gt; :sql_last_value AND create_time &lt; now() ORDER BY create_time desc&quot;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">output&#123;</span><br><span class="line"></span><br><span class="line">	# 根据jdbc中的type值指定输入的jdbc对应的输出为哪一个elasticsearch</span><br><span class="line">	</span><br><span class="line">	if[type]==&quot;department&quot;&#123;</span><br><span class="line"></span><br><span class="line">		elasticsearch&#123;</span><br><span class="line">			# 集群地址</span><br><span class="line">			hosts =&gt; [&quot;127.0.0.1:9200&quot;,&quot;127.0.0.1:9201&quot;,&quot;127.0.0.1:9202&quot;]</span><br><span class="line">			# 索引名称</span><br><span class="line">			index =&gt; &quot;department&quot;</span><br><span class="line">			# 生成根据dept_id,生成ES的 _id</span><br><span class="line">			document_id =&gt; &quot;%&#123;dept_id&#125;&quot;</span><br><span class="line">			# 类型</span><br><span class="line">			document_type =&gt; &quot;dept_doc&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	if[type]==&quot;student&quot;&#123;</span><br><span class="line">		</span><br><span class="line">		elasticsearch&#123;</span><br><span class="line">			# 集群地址</span><br><span class="line">			hosts =&gt; [&quot;127.0.0.1:9200&quot;,&quot;127.0.0.1:9201&quot;,&quot;127.0.0.1:9202&quot;]</span><br><span class="line">			# 索引名称</span><br><span class="line">			index =&gt; &quot;student&quot;</span><br><span class="line">			# 生成根据student_id,生成ES的 _id</span><br><span class="line">			document_id =&gt; &quot;%&#123;student_id&#125;&quot;</span><br><span class="line">			# 类型</span><br><span class="line">			document_type =&gt; &quot;student_doc&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="4-2-使用其他字段进行追踪-设置使用主键进行追踪"><a href="#4-2-使用其他字段进行追踪-设置使用主键进行追踪" class="headerlink" title="4.2 使用其他字段进行追踪(设置使用主键进行追踪)"></a>4.2 使用其他字段进行追踪(设置使用主键进行追踪)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在修改其他字段进行追踪时,一定不要忘记修改tracking_column_type类型,详情修改请参官网</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">input&#123;</span><br><span class="line">	# 第1张表</span><br><span class="line">	jdbc&#123;</span><br><span class="line">		# 设置当前jdbc的type</span><br><span class="line">		type =&gt; &quot;department&quot;</span><br><span class="line">		# 数据库驱动地址</span><br><span class="line">		jdbc_driver_library =&gt; &quot;D:\\soft\\logstash-6.3.2\\lib\\mysql-connector-java-5.1.47.jar&quot; </span><br><span class="line">		# 数据库驱动类名</span><br><span class="line">		jdbc_driver_class =&gt; &quot;com.mysql.jdbc.Driver&quot;</span><br><span class="line">		# 数据库连接地址</span><br><span class="line">		jdbc_connection_string =&gt; &quot;jdbc:mysql://127.0.0.1:3306/gn_oa&quot;</span><br><span class="line">		# 数据库用户名</span><br><span class="line">		jdbc_user =&gt; &quot;root&quot;</span><br><span class="line">		# 数据库密码</span><br><span class="line">		jdbc_password =&gt; &quot;root&quot;</span><br><span class="line">		# 定时任务,一分钟同步一次</span><br><span class="line">		schedule =&gt; &quot;* * * * *&quot;</span><br><span class="line">		# 如果sql语句使用sql_last_value属性要设置use_column_value为true,并且指定tracking_column属性,指定哪一列</span><br><span class="line">		use_column_value =&gt; true</span><br><span class="line">		# 指定sql_last_value参数使用哪一列</span><br><span class="line">		tracking_column =&gt; &quot;dept_id&quot;</span><br><span class="line">		# 设置tracking_column属性名保存的状态</span><br><span class="line">		last_run_metadata_path =&gt; &quot;D:\\soft\\logstash-6.3.2\\a\\a.txt&quot;</span><br><span class="line">		# 是否保留前一次的运行状态,如果不保留下次重启服务器所以会被重新创建</span><br><span class="line">		clean_run =&gt; false</span><br><span class="line">		# 设置列的类型</span><br><span class="line">		tracking_column_type =&gt; &quot;numeric&quot;</span><br><span class="line">		# 生成索引的数据来源</span><br><span class="line">		statement =&gt; &quot;SELECT * FROM department WHERE dept_id &gt; :sql_last_value&quot;</span><br><span class="line">	&#125;</span><br><span class="line">	# 第2张表</span><br><span class="line">	jdbc&#123;</span><br><span class="line">		# 设置当前jdbc的type</span><br><span class="line">		type =&gt; &quot;student&quot;</span><br><span class="line">		# 数据库驱动地址</span><br><span class="line">		jdbc_driver_library =&gt; &quot;D:\\soft\\logstash-6.3.2\\lib\\mysql-connector-java-5.1.47.jar&quot; </span><br><span class="line">		# 数据库驱动类名</span><br><span class="line">		jdbc_driver_class =&gt; &quot;com.mysql.jdbc.Driver&quot;</span><br><span class="line">		# 数据库连接地址</span><br><span class="line">		jdbc_connection_string =&gt; &quot;jdbc:mysql://127.0.0.1:3306/gn_oa&quot;</span><br><span class="line">		# 数据库用户名</span><br><span class="line">		jdbc_user =&gt; &quot;root&quot;</span><br><span class="line">		# 数据库密码</span><br><span class="line">		jdbc_password =&gt; &quot;root&quot;</span><br><span class="line">		# 定时任务,一分钟同步一次</span><br><span class="line">		schedule =&gt; &quot;* * * * *&quot;</span><br><span class="line">		# 如果sql语句使用sql_last_value属性要设置use_column_value为true</span><br><span class="line">		use_column_value =&gt; true</span><br><span class="line">		# 指定sql_last_value参数使用哪一列</span><br><span class="line">		tracking_column =&gt; &quot;student_id&quot;</span><br><span class="line">		# 设置tracking_column属性名保存的状态</span><br><span class="line">		last_run_metadata_path =&gt; &quot;D:\\soft\\logstash-6.3.2\\b\\b.txt&quot;</span><br><span class="line">		# 是否保留前一次的运行状态,如果不保留下次重启服务器所以会被重新创建</span><br><span class="line">		clean_run =&gt; false</span><br><span class="line">		# 设置列的类型</span><br><span class="line">		tracking_column_type =&gt; &quot;numeric&quot;</span><br><span class="line">		# 生成索引的数据来源</span><br><span class="line">		statement =&gt; &quot;SELECT * FROM student WHERE student_id &gt; :sql_last_value&quot;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">output&#123;</span><br><span class="line"></span><br><span class="line">	# 根据jdbc中的type值指定输入的jdbc对应的输出为哪一个elasticsearch</span><br><span class="line">	</span><br><span class="line">	if[type]==&quot;department&quot;&#123;</span><br><span class="line"></span><br><span class="line">		elasticsearch&#123;</span><br><span class="line">			# 集群地址</span><br><span class="line">			hosts =&gt; [&quot;127.0.0.1:9200&quot;,&quot;127.0.0.1:9201&quot;,&quot;127.0.0.1:9202&quot;]</span><br><span class="line">			# 索引名称</span><br><span class="line">			index =&gt; &quot;department&quot;</span><br><span class="line">			# 生成根据dept_id,生成ES的 _id</span><br><span class="line">			document_id =&gt; &quot;%&#123;dept_id&#125;&quot;</span><br><span class="line">			# 类型</span><br><span class="line">			document_type =&gt; &quot;dept_doc&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	if[type]==&quot;student&quot;&#123;</span><br><span class="line">		</span><br><span class="line">		elasticsearch&#123;</span><br><span class="line">			# 集群地址</span><br><span class="line">			hosts =&gt; [&quot;127.0.0.1:9200&quot;,&quot;127.0.0.1:9201&quot;,&quot;127.0.0.1:9202&quot;]</span><br><span class="line">			# 索引名称</span><br><span class="line">			index =&gt; &quot;student&quot;</span><br><span class="line">			# 生成根据student_id,生成ES的 _id</span><br><span class="line">			document_id =&gt; &quot;%&#123;student_id&#125;&quot;</span><br><span class="line">			# 类型</span><br><span class="line">			document_type =&gt; &quot;student_doc&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<blockquote>
<p>注意: 日常bug记录与采坑指南,如果出现下面的BUG并且在进行配置查找的时候,无论怎么校验都不能从自己的配置中找到错误,但是服务器还启动不起来,那么可以尝试在错误信息中查找关键信息,经过反复校验,如果设置了last_run_metadata_path服务器可以正常启动,如果配置中少了last_run_metadata_path 属性服务器启动失败,就会报如下错误,并且在下面的错误中,有相关信息,我的报错信息如下,关键信息last_run_metadata_path&#x3D;&gt;&quot;C:\\Users\\lenovo&#x2F;.logstash_jdbc_last_run&quot;,说明在上次发生错的时候logstash对我上次的错误信息进行的保存,造成服务器每次启动读取错误信息,造成的服务器启动失败,去指定位置删除即可.</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[2020-08-20T02:27:40,897][ERROR][logstash.pipeline        ] Error registering plugin &#123;:pipeline_id=&gt;&quot;main&quot;, :plugin=&gt;&quot;&lt;LogStash::Inputs::Jdbc jdbc_driver_library=&gt;\&quot;D:\\\\\\\\soft\\\\\\\\logstash-6.3.2\\\\\\\\lib\\\\\\\\mysql-connector-java-5.1.47.jar\&quot;, jdbc_driver_class=&gt;\&quot;com.mysql.jdbc.Driver\&quot;, jdbc_connection_string=&gt;\&quot;jdbc:mysql://127.0.0.1:3306/gn_oa\&quot;, jdbc_user=&gt;\&quot;root\&quot;, jdbc_password=&gt;&lt;password&gt;, schedule=&gt;\&quot;* * * * *\&quot;, statement=&gt;\&quot;SELECT * FROM department\&quot;, id=&gt;\&quot;02efb29127a061192768f52b1a09e6638672c521b53edda48b19f6b9880e90d6\&quot;, enable_metric=&gt;true, codec=&gt;&lt;LogStash::Codecs::Plain id=&gt;\&quot;plain_e50f7aa8-3c57-4f33-9000-86265d442ec7\&quot;, enable_metric=&gt;true, charset=&gt;\&quot;UTF-8\&quot;&gt;, jdbc_paging_enabled=&gt;false, jdbc_page_size=&gt;100000, jdbc_validate_connection=&gt;false, jdbc_validation_timeout=&gt;3600, jdbc_pool_timeout=&gt;5, sql_log_level=&gt;\&quot;info\&quot;, connection_retry_attempts=&gt;1, connection_retry_attempts_wait_time=&gt;0.5, last_run_metadata_path=&gt;\&quot;C:\\\\Users\\\\lenovo/.logstash_jdbc_last_run\&quot;, use_column_value=&gt;false, tracking_column_type=&gt;\&quot;numeric\&quot;, clean_run=&gt;false, record_last_run=&gt;true, lowercase_column_names=&gt;true&gt;&quot;, :error=&gt;&quot;can&#x27;t dup Fixnum&quot;, :thread=&gt;&quot;#&lt;Thread:0x703b95e6 run&gt;&quot;&#125;</span><br><span class="line">[2020-08-20T02:27:41,426][ERROR][logstash.pipeline        ] Pipeline aborted due to error &#123;:pipeline_id=&gt;&quot;main&quot;, :exception=&gt;#&lt;TypeError: can&#x27;t dup Fixnum&gt;, :backtrace=&gt;[&quot;org/jruby/RubyKernel.java:1882:in `dup&#x27;&quot;, &quot;uri:classloader:/META-INF/jruby.home/lib/ruby/stdlib/date/format.rb:838:in `_parse&#x27;&quot;, &quot;uri:classloader:/META-INF/jruby.home/lib/ruby/stdlib/date.rb:1830:in `parse&#x27;&quot;, &quot;D:/soft/logstash-6.3.2/vendor/bundle/jruby/2.3.0/gems/logstash-input-jdbc-4.3.9/lib/logstash/plugin_mixins/value_tracking.rb:87:in `set_value&#x27;&quot;, &quot;D:/soft/logstash-6.3.2/vendor/bundle/jruby/2.3.0/gems/logstash-input-jdbc-4.3.9/lib/logstash/plugin_mixins/value_tracking.rb:36:in `initialize&#x27;&quot;, &quot;D:/soft/logstash-6.3.2/vendor/bundle/jruby/2.3.0/gems/logstash-input-jdbc-4.3.9/lib/logstash/plugin_mixins/value_tracking.rb:29:in `build_last_value_tracker&#x27;&quot;, &quot;D:/soft/logstash-6.3.2/vendor/bundle/jruby/2.3.0/gems/logstash-input-jdbc-4.3.9/lib/logstash/inputs/jdbc.rb:216:in `register&#x27;&quot;, &quot;D:/soft/logstash-6.3.2/logstash-core/lib/logstash/pipeline.rb:340:in `register_plugin&#x27;&quot;, &quot;D:/soft/logstash-6.3.2/logstash-core/lib/logstash/pipeline.rb:351:in `block in register_plugins&#x27;&quot;, &quot;org/jruby/RubyArray.java:1734:in `each&#x27;&quot;, &quot;D:/soft/logstash-6.3.2/logstash-core/lib/logstash/pipeline.rb:351:in `register_plugins&#x27;&quot;, &quot;D:/soft/logstash-6.3.2/logstash-core/lib/logstash/pipeline.rb:498:in `start_inputs&#x27;&quot;, &quot;D:/soft/logstash-6.3.2/logstash-core/lib/logstash/pipeline.rb:392:in `start_workers&#x27;&quot;, &quot;D:/soft/logstash-6.3.2/logstash-core/lib/logstash/pipeline.rb:288:in `run&#x27;&quot;, &quot;D:/soft/logstash-6.3.2/logstash-core/lib/logstash/pipeline.rb:248:in `block in start&#x27;&quot;], :thread=&gt;&quot;#&lt;Thread:0x703b95e6 run&gt;&quot;&#125;</span><br><span class="line">[2020-08-20T02:27:41,467][ERROR][logstash.agent           ] Failed to execute action &#123;:id=&gt;:main, :action_type=&gt;LogStash::ConvergeResult::FailedAction, :message=&gt;&quot;Could not execute action: PipelineAction::Create&lt;main&gt;, action_result: false&quot;, :backtrace=&gt;nil&#125;</span><br></pre></td></tr></table></figure>
    </div>

    
    
    <div>
	
		<div style="text-align:center;color: #ccc;font-size:14px; padding-top: 10px;">----------------本文结束<i class="fa fa-paw"></i>感谢您的阅读---------------</div>
	
</div>

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Elasticsearch/" rel="tag"># Elasticsearch</a>
              <a href="/tags/ELK/" rel="tag"># ELK</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2024/07/02/EasyExcel(%E7%94%9F%E6%88%90Excel%E6%8A%A5%E8%A1%A8)%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/" rel="prev" title="EasyExcel基本操作">
      <i class="fa fa-chevron-left"></i> EasyExcel基本操作
    </a></div>
      <div class="post-nav-item">
    <a href="/2024/07/02/Java8%E6%96%B0%E7%89%B9%E6%80%A7(%E5%A4%9C%E6%B3%8A2.0%E7%89%88)/" rel="next" title="JDK8新特性">
      JDK8新特性 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E7%AB%A0-ES%E7%AE%80%E4%BB%8B"><span class="nav-text">第一章 ES简介</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC1%E8%8A%82-ES%E4%BB%8B%E7%BB%8D"><span class="nav-text">第1节 ES介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC2%E8%8A%82-ES%E7%89%88%E6%9C%AC"><span class="nav-text">第2节 ES版本</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E7%AB%A0-%E5%AE%89%E8%A3%85-v6-3-2"><span class="nav-text">第二章 安装(v6.3.2)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC1%E8%8A%82-window%E4%B8%8B%E5%8D%95%E7%82%B9%E5%AE%89%E8%A3%85ES"><span class="nav-text">第1节 window下单点安装ES</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC2%E8%8A%82-window%E4%B8%8B%E5%AE%89%E8%A3%85Head%E6%8F%92%E4%BB%B6"><span class="nav-text">第2节 window下安装Head插件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-Head%E6%8F%92%E4%BB%B6%E4%BB%8B%E7%BB%8D"><span class="nav-text">2.1 Head插件介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-Head%E6%8F%92%E4%BB%B6%E4%B8%8B%E8%BD%BD%E5%9C%B0%E5%9D%80"><span class="nav-text">2.2 Head插件下载地址</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4"><span class="nav-text">2.3 安装步骤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-Head%E6%8F%92%E4%BB%B6%E5%92%8CES%E5%85%B3%E8%81%94%E9%85%8D%E7%BD%AE"><span class="nav-text">2.4 Head插件和ES关联配置</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC3%E8%8A%82-window-ES-%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85"><span class="nav-text">第3节 window ES 集群安装</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E6%AD%A5%E9%AA%A4"><span class="nav-text">3.1 集群配置步骤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%BC%96%E5%86%99"><span class="nav-text">3.2 配置文件编写</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E7%AB%A0-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="nav-text">第三章 基础概念</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC1%E8%8A%82-%E7%B4%A2%E5%BC%95"><span class="nav-text">第1节 索引</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC2%E8%8A%82-%E7%B1%BB%E5%9E%8B"><span class="nav-text">第2节 类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC3%E8%8A%82-%E6%96%87%E6%A1%A3"><span class="nav-text">第3节 文档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC4%E8%8A%82-%E5%88%86%E7%89%87-x2F-%E5%89%AF%E6%9C%AC-%E5%A4%87%E4%BB%BD"><span class="nav-text">第4节 分片&#x2F;副本(备份)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E5%9B%9B%E7%AB%A0-%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="nav-text">第四章 基本用法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC1%E8%8A%82-ES-%E7%9A%84-RESTFul-API"><span class="nav-text">第1节 ES 的 RESTFul API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC2%E8%8A%82-%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="nav-text">第2节 创建索引</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-%E4%BD%BF%E7%94%A8Head%E6%8F%92%E4%BB%B6%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="nav-text">2.1 使用Head插件创建索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-%E7%BB%93%E6%9E%84%E5%8C%96%E7%B4%A2%E5%BC%95-x2F-%E9%9D%9E%E7%BB%93%E6%9E%84%E5%8C%96%E7%B4%A2%E5%BC%95"><span class="nav-text">2.2 结构化索引&#x2F;非结构化索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-%E4%BD%BF%E7%94%A8postman%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="nav-text">2.3 使用postman创建索引</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC3%E8%8A%82-%E6%95%B0%E6%8D%AE%E6%8F%92%E5%85%A5-postman"><span class="nav-text">第3节 数据插入(postman)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-%E6%8C%87%E5%AE%9Aid%E6%8F%92%E5%85%A5"><span class="nav-text">3.1 指定id插入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90id%E6%8F%92%E5%85%A5"><span class="nav-text">3.2 自动生成id插入</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC4%E8%8A%82-%E6%95%B0%E6%8D%AE%E4%BF%AE%E6%94%B9-postman"><span class="nav-text">第4节 数据修改(postman)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-%E7%9B%B4%E6%8E%A5%E4%BF%AE%E6%94%B9%E6%96%87%E6%A1%A3"><span class="nav-text">4.1 直接修改文档</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-%E4%BD%BF%E7%94%A8%E8%84%9A%E6%9C%AC%E4%BF%AE%E6%94%B9%E6%96%87%E6%A1%A3-%E4%BA%86%E8%A7%A3"><span class="nav-text">4.2 使用脚本修改文档(了解)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#4-2-1-Painless%E7%AE%80%E4%BB%8B"><span class="nav-text">4.2.1 Painless简介</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-2-2-Painless%E4%BD%BF%E7%94%A8"><span class="nav-text">4.2.2  Painless使用</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC5%E8%8A%82-%E6%95%B0%E6%8D%AE%E5%88%A0%E9%99%A4-postman"><span class="nav-text">第5节 数据删除(postman)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3-postman"><span class="nav-text">5.1 删除文档(postman)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95-postman"><span class="nav-text">5.2 删除索引(postman)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-3-%E4%BD%BF%E7%94%A8head%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95"><span class="nav-text">5.3 使用head删除索引</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%BA%94%E7%AB%A0-%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2-Kibana"><span class="nav-text">第五章 高级查询(Kibana)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC1%E8%8A%82-Kibana%E5%AE%89%E8%A3%85"><span class="nav-text">第1节 Kibana安装</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-Kibana%E7%AE%80%E4%BB%8B"><span class="nav-text">1.1 Kibana简介</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-Kibana%E4%B8%8B%E8%BD%BD"><span class="nav-text">1.2 Kibana下载</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-Kibana%E5%AE%89%E8%A3%85"><span class="nav-text">1.3 Kibana安装</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC2%E8%8A%82-Kibana%E4%BD%BF%E7%94%A8"><span class="nav-text">第2节 Kibana使用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-text">2.1 基本操作</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#2-1-1-%E6%9F%A5%E7%9C%8B%E9%9B%86%E7%BE%A4%E5%81%A5%E5%BA%B7%E7%8A%B6%E6%80%81"><span class="nav-text">2.1.1 查看集群健康状态</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-1-2-%E6%9F%A5%E7%9C%8B%E8%8A%82%E7%82%B9%E7%8A%B6%E6%80%81"><span class="nav-text">2.1.2 查看节点状态</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-1-3-%E6%9F%A5%E7%9C%8B%E7%B4%A2%E5%BC%95%E4%BF%A1%E6%81%AF"><span class="nav-text">2.1.3 查看索引信息</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-1-4-%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="nav-text">2.1.4 创建索引</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-1-5-%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95"><span class="nav-text">2.1.5 删除索引</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-1-6-%E5%90%91%E6%96%87%E6%A1%A3%E4%B8%AD%E6%B7%BB%E5%8A%A0%E6%95%B0%E6%8D%AE"><span class="nav-text">2.1.6 向文档中添加数据</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-1-7-%E6%9F%A5%E7%9C%8B%E6%96%87%E6%A1%A3%E7%B1%BB%E5%9E%8B"><span class="nav-text">2.1.7 查看文档类型</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-1-8-%E6%9F%A5%E7%9C%8B%E7%B4%A2%E5%BC%95%E4%B8%AD%E7%9A%84%E6%96%87%E6%A1%A3-%E6%A0%B9%E6%8D%AEID%E6%9F%A5%E8%AF%A2"><span class="nav-text">2.1.8 查看索引中的文档(根据ID查询)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-1-9-%E6%9B%B4%E6%96%B0%E7%B4%A2%E5%BC%95%E4%B8%AD%E7%9A%84%E6%96%87%E6%A1%A3"><span class="nav-text">2.1.9 更新索引中的文档</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-1-10-%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95%E4%B8%AD%E7%9A%84%E6%96%87%E6%A1%A3"><span class="nav-text">2.1.10 删除索引中的文档</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-1-11-%E5%AF%B9%E7%B4%A2%E5%BC%95%E4%B8%AD%E7%9A%84%E6%96%87%E6%A1%A3%E8%BF%9B%E8%A1%8C%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C"><span class="nav-text">2.1.11 对索引中的文档进行批量操作</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2"><span class="nav-text">2.2 高级查询</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-1-%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5"><span class="nav-text">2.2.1 数据导入</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-2-%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2"><span class="nav-text">2.2.2 高级查询</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#2-2-2-1-%E7%AE%80%E5%8D%95%E6%90%9C%E7%B4%A2"><span class="nav-text">2.2.2.1 简单搜索</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#2-2-2-2-%E6%9D%A1%E4%BB%B6%E6%90%9C%E7%B4%A2-match"><span class="nav-text">2.2.2.2 条件搜索(match)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#2-2-2-3-%E7%9F%AD%E8%AF%AD%E5%8C%B9%E9%85%8D%E6%90%9C%E7%B4%A2-match-phrase"><span class="nav-text">2.2.2.3 短语匹配搜索(match_phrase)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#2-2-2-4-%E7%BB%84%E5%90%88%E6%90%9C%E7%B4%A2-bool"><span class="nav-text">2.2.2.4 组合搜索(bool)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#2-2-2-5-%E8%BF%87%E6%BB%A4%E6%90%9C%E7%B4%A2-filter"><span class="nav-text">2.2.2.5 过滤搜索(filter)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#2-2-2-6-%E6%90%9C%E7%B4%A2%E8%81%9A%E5%90%88-aggs"><span class="nav-text">2.2.2.6 搜索聚合(aggs)</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E5%85%AD%E7%AB%A0-ES%E5%92%8CSpringBoot%E6%95%B4%E5%90%88-Spring-data%E7%89%88%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="nav-text">第六章 ES和SpringBoot整合(Spring-data版本使用)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC1%E8%8A%82-%E5%88%86%E8%AF%8D%E5%99%A8%E4%BB%8B%E7%BB%8D"><span class="nav-text">第1节 分词器介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-%E5%88%86%E8%AF%8D%E5%99%A8%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="nav-text">1.1 分词器的作用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-%E5%B8%B8%E8%A7%81%E5%88%86%E8%AF%8D%E5%99%A8"><span class="nav-text">1.2 常见分词器</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC2%E8%8A%82-standars%E5%88%86%E8%AF%8D%E5%99%A8%E6%BC%94%E7%A4%BA-kibana%E5%B7%A5%E5%85%B7"><span class="nav-text">第2节 standars分词器演示(kibana工具)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-%E6%BC%94%E7%A4%BA%E8%8B%B1%E6%96%87"><span class="nav-text">2.1 演示英文</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-%E6%BC%94%E7%A4%BA%E4%B8%AD%E6%96%87"><span class="nav-text">2.2 演示中文</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC3%E8%8A%82-ik%E5%88%86%E8%AF%8D%E5%99%A8%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8"><span class="nav-text">第3节 ik分词器安装和使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC4%E8%8A%82-ik%E5%88%86%E8%AF%8D%E5%99%A8%E6%BC%94%E7%A4%BA-kibana%E5%B7%A5%E5%85%B7"><span class="nav-text">第4节 ik分词器演示(kibana工具)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC5%E8%8A%82-ES%E5%92%8CSpringBoot%E6%95%B4%E5%90%88"><span class="nav-text">第5节 ES和SpringBoot整合</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-%E5%88%9B%E5%BB%BASpringBoot%E9%A1%B9%E7%9B%AE"><span class="nav-text">5.1 创建SpringBoot项目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-%E9%85%8D%E7%BD%AE"><span class="nav-text">5.2 配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-3-%E5%B8%B8%E8%A7%81%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="nav-text">5.3 常见的操作</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#5-3-1-%E6%98%A0%E5%B0%84ES%E6%96%87%E6%A1%A3%E7%9A%84%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="nav-text">5.3.1 映射ES文档的实体类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-3-2-%E6%93%8D%E4%BD%9CES%E7%9A%84%E6%8E%A5%E5%8F%A3"><span class="nav-text">5.3.2 操作ES的接口</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-3-3-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%93%8D%E4%BD%9C"><span class="nav-text">5.3.3 单元测试操作</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%83%E7%AB%A0-ES%E5%92%8CMYSQL%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5"><span class="nav-text">第七章 ES和MYSQL数据同步</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC1%E8%8A%82-logstash%E7%AE%80%E4%BB%8B"><span class="nav-text">第1节 logstash简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC2%E8%8A%82-logstash%E4%B8%8B%E8%BD%BD-6-3-2"><span class="nav-text">第2节 logstash下载(6.3.2)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC3%E8%8A%82-logstash%E9%85%8D%E7%BD%AE-%E7%AE%80%E5%8D%95%E9%85%8D%E7%BD%AE-%E5%8D%95%E8%A1%A8-x2F-%E5%A4%9A%E8%A1%A8"><span class="nav-text">第3节 logstash配置(简单配置-单表&#x2F;多表)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC4%E8%8A%82-logstash%E9%85%8D%E7%BD%AE-%E5%85%B6%E4%BB%96%E9%85%8D%E7%BD%AE"><span class="nav-text">第4节 logstash配置(其他配置)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-%E4%BD%BF%E7%94%A8%E6%97%B6%E9%97%B4%E5%AD%97%E6%AE%B5%E8%BF%9B%E8%A1%8C%E8%BF%BD%E8%B8%AA-%E4%B8%80%E8%88%AC%E4%BD%BF%E7%94%A8%E6%9B%B4%E6%96%B0%E6%97%B6%E9%97%B4%E5%AD%97%E6%AE%B5"><span class="nav-text">4.1 使用时间字段进行追踪(一般使用更新时间字段)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-%E4%BD%BF%E7%94%A8%E5%85%B6%E4%BB%96%E5%AD%97%E6%AE%B5%E8%BF%9B%E8%A1%8C%E8%BF%BD%E8%B8%AA-%E8%AE%BE%E7%BD%AE%E4%BD%BF%E7%94%A8%E4%B8%BB%E9%94%AE%E8%BF%9B%E8%A1%8C%E8%BF%BD%E8%B8%AA"><span class="nav-text">4.2 使用其他字段进行追踪(设置使用主键进行追踪)</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="夜泊1990"
      src="/images/avatar.jpeg">
  <p class="site-author-name" itemprop="name">夜泊1990</p>
  <div class="site-description" itemprop="description">俱往矣,要多呲花,有多呲花</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">35</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">104</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">夜泊1990</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">687k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">10:25</span>
</div>
        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
