<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"hd1611756908.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="123456作者: 夜泊1990企鹅: 1611756908鹅群: 948233848邮箱: hd1611756908@163.com博客: https:&#x2F;&#x2F;hd1611756908.github.io&#x2F;B 站: https:&#x2F;&#x2F;space.bilibili.com&#x2F;514155929&#x2F;   第一章 zookeeper简介第1节 zookeeper的由来12341. zookeeper最早起源于雅">
<meta property="og:type" content="article">
<meta property="og:title" content="zookeeper简单入门">
<meta property="og:url" content="https://hd1611756908.github.io/2024/07/02/zookeeper%E7%AE%80%E5%8D%95%E5%85%A5%E9%97%A8/index.html">
<meta property="og:site_name" content="枫桥夜泊">
<meta property="og:description" content="123456作者: 夜泊1990企鹅: 1611756908鹅群: 948233848邮箱: hd1611756908@163.com博客: https:&#x2F;&#x2F;hd1611756908.github.io&#x2F;B 站: https:&#x2F;&#x2F;space.bilibili.com&#x2F;514155929&#x2F;   第一章 zookeeper简介第1节 zookeeper的由来12341. zookeeper最早起源于雅">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://note.youdao.com/yws/api/personal/file/WEB75337e57182c1aac3c41660a7fc52996?method=download&shareKey=6e6030a13ede57921894329316c7663b">
<meta property="og:image" content="https://note.youdao.com/yws/api/personal/file/WEBb37b63f7f7b4417b376e3d8e82c5e095?method=download&shareKey=95e242a2684d3a65cf708611e2a0acd7">
<meta property="og:image" content="https://note.youdao.com/yws/api/personal/file/WEB6bc43e0148ec9cb8171795ec662d6f44?method=download&shareKey=b69393e2b42212ad7e876511f2e0b904">
<meta property="og:image" content="https://note.youdao.com/yws/api/personal/file/WEBd0726e08fc0eeab8c700edaf0f2657c7?method=download&shareKey=cdadceeb16e68767bba605cfad2b22a3">
<meta property="og:image" content="https://note.youdao.com/yws/api/personal/file/WEB134023e11301692196643204f95658d4?method=download&shareKey=d9204cdd6ab11be04933de5b3a947e6e">
<meta property="og:image" content="https://note.youdao.com/yws/api/personal/file/WEB43d73524c47cce02d098f6a071c1af56?method=download&shareKey=ef272735f6ffff8dd266dc5580887424">
<meta property="og:image" content="https://note.youdao.com/yws/api/personal/file/WEBa5e0a13dd7e6198425f511665812ac22?method=download&shareKey=c3195d9de6287bceca65af05a07cf497">
<meta property="article:published_time" content="2024-07-02T13:37:12.011Z">
<meta property="article:modified_time" content="2024-07-02T13:43:55.910Z">
<meta property="article:author" content="夜泊1990">
<meta property="article:tag" content="java">
<meta property="article:tag" content="zookeeper">
<meta property="article:tag" content="分布式配置中心">
<meta property="article:tag" content="注册中心">
<meta property="article:tag" content="zk">
<meta property="article:tag" content="config-toolkit">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://note.youdao.com/yws/api/personal/file/WEB75337e57182c1aac3c41660a7fc52996?method=download&shareKey=6e6030a13ede57921894329316c7663b">

<link rel="canonical" href="https://hd1611756908.github.io/2024/07/02/zookeeper%E7%AE%80%E5%8D%95%E5%85%A5%E9%97%A8/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>zookeeper简单入门 | 枫桥夜泊</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="枫桥夜泊" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">枫桥夜泊</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">每走一步,都是进步</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://gitee.com/ukoko" class="github-corner" title="Follow me on GitEE" aria-label="Follow me on GitEE" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://hd1611756908.github.io/2024/07/02/zookeeper%E7%AE%80%E5%8D%95%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="夜泊1990">
      <meta itemprop="description" content="俱往矣,要多呲花,有多呲花">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫桥夜泊">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          zookeeper简单入门
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2024-07-02 21:37:12 / 修改时间：21:43:55" itemprop="dateCreated datePublished" datetime="2024-07-02T21:37:12+08:00">2024-07-02</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/zookeeper/" itemprop="url" rel="index"><span itemprop="name">zookeeper</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>21k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>19 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">作者: 夜泊1990</span><br><span class="line">企鹅: 1611756908</span><br><span class="line">鹅群: 948233848</span><br><span class="line">邮箱: hd1611756908@163.com</span><br><span class="line">博客: https://hd1611756908.github.io/</span><br><span class="line">B 站: https://space.bilibili.com/514155929/</span><br></pre></td></tr></table></figure>


<h2 id="第一章-zookeeper简介"><a href="#第一章-zookeeper简介" class="headerlink" title="第一章 zookeeper简介"></a>第一章 zookeeper简介</h2><h3 id="第1节-zookeeper的由来"><a href="#第1节-zookeeper的由来" class="headerlink" title="第1节 zookeeper的由来"></a>第1节 zookeeper的由来</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. zookeeper最早起源于雅虎研究院的一个研究小组</span><br><span class="line">2. 在雅虎内部很多大型系统基本都需要依赖一个类似的系统来进行分布式协调,并且这个系统还有单点问题</span><br><span class="line">3. 雅虎的开发人员就试图开发一个通用的无单点问题的分布式协调框架,以便让开发人员将精力集中在处理业务逻辑上,这是最早zookeeper的原型</span><br><span class="line">4. 后来捐献给了apache成为了apache的顶级项目</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h3 id="第2节-zookeeper名字的由来"><a href="#第2节-zookeeper名字的由来" class="headerlink" title="第2节 zookeeper名字的由来"></a>第2节 zookeeper名字的由来</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">雅虎研究院很多项目都以动物命名,而zookeeper做为各个项目之间的协调,就起了一个动物管理员的名字(zookeeper),简称zk</span><br></pre></td></tr></table></figure>

<h3 id="第3节-zk应用场景"><a href="#第3节-zk应用场景" class="headerlink" title="第3节 zk应用场景"></a>第3节 zk应用场景</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 注册中心(Dubbo框架介绍)</span><br><span class="line">2. 配置中心</span><br><span class="line">3. 分布式锁(本文不做讲解)</span><br><span class="line">...</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="第二章-zk的下载"><a href="#第二章-zk的下载" class="headerlink" title="第二章 zk的下载"></a>第二章 zk的下载</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">这里以3.4.9版本为例,下面是下载地址,下载zookeeper-3.4.9.tar.gz压缩包(在Windows/Linux/Mac下通用)</span><br><span class="line"></span><br><span class="line">https://archive.apache.org/dist/zookeeper/zookeeper-3.4.9/</span><br></pre></td></tr></table></figure>

<h2 id="第三章-zk的单点安装"><a href="#第三章-zk的单点安装" class="headerlink" title="第三章 zk的单点安装"></a>第三章 zk的单点安装</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">1. 平台支持</span><br><span class="line">	1.1 Windows 服务端和客户端开发和生产环境都支持</span><br><span class="line">	1.2 Linux   服务端和客户端开发和生产环境都支持</span><br><span class="line">	</span><br><span class="line">2. 软件环境</span><br><span class="line">	2.1 客户端和服务器端都是用Java语言编写,需要本机安装JDK</span><br><span class="line">	2.2 zookeeper3.4.9版本需要JDK版本大于等于1.6</span><br><span class="line">	</span><br><span class="line">3. 单点安装步骤</span><br><span class="line">	3.1 下载zookeeper安装包</span><br><span class="line">	3.2 解压zookeeper</span><br><span class="line">	3.3 在conf文件夹下找到zoo_sample.cfg将其重命名为zoo.cfg</span><br><span class="line">	3.4 修改配置</span><br><span class="line">		# zookeeper服务器心跳检测</span><br><span class="line">		tickTime=2000</span><br><span class="line">		# zookeeper存放数据的目录,zookeepr服务器可以保存数据</span><br><span class="line">		dataDir=/tmp/zookeeper</span><br><span class="line">		# 服务器启动占用的端口号,用于客户端连接使用</span><br><span class="line">		clientPort=2181</span><br><span class="line">4. 启动和停止</span><br><span class="line">	4.1 启动</span><br><span class="line">		- Windows: bin目录下直接双击 zkServer.cmd</span><br><span class="line">		- Linux  : 使用命令行工具,在bin目录下 zkServer.sh start</span><br><span class="line">	4.2 停止</span><br><span class="line">		- Windows: ctrl+c 或者 使用命令杀进程</span><br><span class="line">		- Linux  : 使用命令行工具,在bin目录下 zkServer.sh stop</span><br></pre></td></tr></table></figure>

<h2 id="第四章-zk客户端使用"><a href="#第四章-zk客户端使用" class="headerlink" title="第四章 zk客户端使用"></a>第四章 zk客户端使用</h2><h3 id="第1节-客户端连接"><a href="#第1节-客户端连接" class="headerlink" title="第1节 客户端连接"></a>第1节 客户端连接</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">连接命令: zkCli.sh -server 127.0.0.1:2181</span><br></pre></td></tr></table></figure>

<h3 id="第2节-zk节点概述"><a href="#第2节-zk节点概述" class="headerlink" title="第2节 zk节点概述"></a>第2节 zk节点概述</h3><h4 id="2-1-zk节点概念"><a href="#2-1-zk节点概念" class="headerlink" title="2.1 zk节点概念"></a>2.1 zk节点概念</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zk可以看成是一个小型的数据存储系统,他的数据存储结构和Unix文件系统类型类似(树形结构).</span><br></pre></td></tr></table></figure>

<table>
    <tr>
        <td style="text-align:center;font-size:10px;">zk节点图例</td>
        <td style="text-align:center;font-size:10px;">Unix/Linux文件系统图例</td>
    </tr>
    <tr>
        <td>
            <img src="https://note.youdao.com/yws/api/personal/file/WEB75337e57182c1aac3c41660a7fc52996?method=download&shareKey=6e6030a13ede57921894329316c7663b">
        </td>
        <td>
            <img src="https://note.youdao.com/yws/api/personal/file/WEBb37b63f7f7b4417b376e3d8e82c5e095?method=download&shareKey=95e242a2684d3a65cf708611e2a0acd7">
        </td>
    </tr>
</table>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. zk的数据存储在树形结构的节点中(例如根节点/、app1节点、app2节点以及子节点等)</span><br><span class="line">2. 每个节点都可以存储数据,还可以创建新的子节点</span><br><span class="line">3. 根节点默认存在,其他节点可以手动操作(创建和销毁)</span><br><span class="line">4. 可以使用zk命令创建不同类型的节点,不同类型的节点拥有不同的特性(持久化/非持久化/顺序等)</span><br></pre></td></tr></table></figure>

<h4 id="2-2-zk节点类型"><a href="#2-2-zk节点类型" class="headerlink" title="2.2 zk节点类型"></a>2.2 zk节点类型</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">zk节点类型分为4种:</span><br><span class="line">1. 持久节点(PERSISTENT) : </span><br><span class="line">	1.1 zk客户端连接zk服务器端会话(session)结束后数据不会丢失</span><br><span class="line">	1.2 持久节点在其下方可以创建子节点</span><br><span class="line">	</span><br><span class="line">2. 临时节点(EPHEMERAL) :</span><br><span class="line">	2.1 zk客户端连接zk服务器端会话(session)结束后数据会丢失</span><br><span class="line">	2.2 临时节点在其下方不可以创建子节点</span><br><span class="line">	</span><br><span class="line">3. 持久顺序节点(PERSISTENT_SEQUENTIAL) :</span><br><span class="line">	3.1 zk客户端连接zk服务器端会话(session)结束后数据不会丢失</span><br><span class="line">	3.2 持久节点在其下方可以创建子节点</span><br><span class="line">	3.3 持久节点在创建同名节点时不能创建成功,但是持久顺序节点可以</span><br><span class="line">	3.4 创建持久顺序节点时,zk会在名称后自动添加一个序号,序号是一个单调递增的计数器,由父节点维护</span><br><span class="line">	</span><br><span class="line">4. 临时顺序节点(EPHEMERAL_SEQUENTIAL) :</span><br><span class="line">	4.1 zk客户端连接zk服务器端会话(session)结束后数据会丢失</span><br><span class="line">	4.2 临时节点在其下方不可以创建子节点</span><br><span class="line">	4.3 临时节点在创建同名节点时不能创建成功,但是临时节点顺序节点可以</span><br><span class="line">	4.3 创建持久顺序节点时,zk会在名称后自动添加一个序号,序号是一个单调递增的计数器,由父节点维护</span><br></pre></td></tr></table></figure>

<h4 id="2-3-zk节点操作"><a href="#2-3-zk节点操作" class="headerlink" title="2.3 zk节点操作"></a>2.3 zk节点操作</h4><ul>
<li>zk常见命令</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">0. help命令 -- 查看当前环境下都可以使用哪些命令</span><br><span class="line"></span><br><span class="line">1. ls命令 -- 查看某一个路径下的目录列表    例如: ls /  查看根目录下的目录列表</span><br><span class="line"></span><br><span class="line">2. ls2命令 -- 查看某个路径下目录列表(相比于ls命令信息更详细)  例如: ls2 /   查看根目录下的目录列表</span><br><span class="line"></span><br><span class="line">3. create命令 -- 创建节点并赋值  例如: create /ukoko val1   创建了一个ukoko节点,并在此节点存储了val1字符串</span><br><span class="line">	3.1 create的格式为  create [-s] [-e] path data acl</span><br><span class="line">	3.2 [-s] [-e] 中括号的参数可有可无 -s表示创建顺序节点  -e表示创建临时节点 不加默认创建持久节点</span><br><span class="line">	3.3 path 指定要创建节点的路径</span><br><span class="line">	3.4 data 要在此节点存储的数据</span><br><span class="line">	3.5 acl 访问权限相关,默认是 world,全世界都能访问</span><br><span class="line">	</span><br><span class="line">4. get命令 -- 获取节点数据和状态信息 例如: get /ukoko   查看当前节点下的数据以及节点固有属性信息</span><br><span class="line">	4.1 get格式  get path [watch]</span><br><span class="line">	4.2 path 要查询的节点路径</span><br><span class="line">	4.3 [watch] 中括号的参数可有可无, watch对节点进行事件监听  例如: get /ukoko watch   查看这个节点,并且监听这个节点数据变化,测试这个节点时需要开启至少两个客户端</span><br><span class="line">	</span><br><span class="line">5. set命令 -- 修改节点存储的数据  例如: set  /ukoko 100 给ukoko节点设置数据</span><br><span class="line">	5.1 set格式 set path data [version]</span><br><span class="line">	5.2 [version] 中括号的参数可有可无  version版本号</span><br><span class="line">	5.3 path 要设置数据的节点路径</span><br><span class="line">	5.4 data 需要存储的数据</span><br><span class="line"></span><br><span class="line">6. delete命令 -- 删除某节点     例如: delete /ukoko</span><br><span class="line">	6.1 delete格式 delete path [version]</span><br><span class="line">	6.2 path 要删除的节点路径</span><br><span class="line">	6.3 [version] 中括号的参数可有可无  version版本号(同set命令)</span><br><span class="line"></span><br><span class="line">7. stat命令 -- 查看节点状态信息   例如: stat /ukoko</span><br><span class="line">	7.1 stat格式 stat path [watch]</span><br><span class="line">	7.2 [watch]中括号的参数可有可无</span><br><span class="line"></span><br><span class="line">8. rmr 命令 -- 强制删除节点以及下子节点  例如 rmr /app</span><br></pre></td></tr></table></figure>

<ul>
<li>zk节点属性详情</li>
</ul>
<table>
    <thead>
        <tr>
            <th>序号</th>
            <th>属性</th>
            <th>数据类型</th>
            <th>描述</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>1</td>
            <td>cZxid</td>
            <td>long</td>
            <td>该节点被创建时的事物id</td>
        </tr>
        <tr>
            <td>2</td>
            <td>ctime</td>
            <td>long</td>
            <td>该节点被创建时的创建时间</td>
        </tr>
        <tr>
            <td>3</td>
            <td>mZxid</td>
            <td>long</td>
            <td>该节点最后被修改时的事务id</td>
        </tr>
        <tr>
            <td>4</td>
            <td>mtime</td>
            <td>long</td>
            <td>该节点最后修改时间</td>
        </tr>
        <tr>
            <td>5</td>
            <td>pZxid</td>
            <td>long</td>
            <td>
                该节点子节点列表最后一次修改的事物id(如果修改子节点里面的数据内容那么事物id不会变化,添加或者删除子节点时此id会变化)
            </td>
        </tr>
        <tr>
            <td>6</td>
            <td>cversion</td>
            <td>long</td>
            <td>子节点版本号(子节点每次修改数据版本号+1)</td>
        </tr>
        <tr>
            <td>7</td>
            <td>dataVersion</td>
            <td>long</td>
            <td>数据版本号(数据每次修改该版本号+1)</td>
        </tr>
        <tr>
            <td>8</td>
            <td>aclVersion</td>
            <td>long</td>
            <td>权限版本号(权限每次修改该版本号+1)</td>
        </tr>
        <tr>
            <td>9</td>
            <td>ephemeralOwner</td>
            <td>long</td>
            <td>创建该临时节点的会话的sessionId,如果不是临时节点那么为0</td>
        </tr>
        <tr>
            <td>10</td>
            <td>dataLength</td>
            <td>int</td>
            <td>该节点的数据长度</td>
        </tr>
        <tr>
            <td>11</td>
            <td>numChildren</td>
            <td>int</td>
            <td>该节点子节点的数量</td>
        </tr>
    </tbody>
</table>

<ul>
<li>zk常见命令使用</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">注意: 所有命令设计到的路径操作必须是绝对路径,不可以是相对路径</span><br></pre></td></tr></table></figure>

<ul>
<li><ul>
<li>创建节点</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">1. 创建持久化节点:</span><br><span class="line">	1.1 命令 create /ukoko val0  创建ukoko节点,并且存储数据val0</span><br><span class="line">	1.2 命令 create /ukoko val1  创建ukoko节点,并且存储数据val1,失败报 Node already exists: /ukoko</span><br><span class="line">	</span><br><span class="line">2. 创建顺序持久化节点:</span><br><span class="line">	2.1 命令 create -s /ukoko  val1 创建ukoko节点,并且存储数据val1</span><br><span class="line">	2.2 命令 create -s /ukoko  val2 创建ukoko节点,并且存储数据val2,成功,因为顺序节点会在节点名称后自动添加序号,使用 ls命令查看</span><br><span class="line">	</span><br><span class="line">3. 创建临时节点</span><br><span class="line">	3.1 命令 create -e /ukoko1  val0 创建ukoko1临时节点,并且存储数据val0</span><br><span class="line">	3.2 使用quit退出命令退出当前会话,会在控制台打印出当前会话id和ephemeralOwner属性对比</span><br><span class="line">	3.3 重新使用客户端命令连接zk服务器,使用ls命令查看,临时节点消失</span><br><span class="line">	</span><br><span class="line">4. 创建顺序临时节点</span><br><span class="line">	4.1 命令 create -s -e /ukoko2 val0 创建ukoko2顺序临时节点,并且存储数据val0</span><br><span class="line">	4.2 命令 create -s -e /ukoko2 val1 创建ukoko2顺序临时节点,并且存储数据val1,成功,因为顺序节点会在节点名称后自动添加序号,使用 ls命令查看</span><br><span class="line">	4.3 使用quit退出命令退出当前会话,会在控制台打印出当前会话id和ephemeralOwner属性对比</span><br><span class="line">	4.3 重新使用客户端命令连接zk服务器,使用ls命令查看,临时节点消失</span><br></pre></td></tr></table></figure>

<ul>
<li><ul>
<li>给节点设置数据</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. 设置普通数据(如果set设置值时不加版本,那么数据版本会随着每次set递增,可以在每次set成功之后查看dataVersion属性)</span><br><span class="line">	1.1 命令 set /ukoko 100</span><br><span class="line">	1.2 查看数据 get /ukoko</span><br><span class="line">2. 设置带版本数据(如果带版本set,那么必须保证版本号与dataVersion版本相同,保证修改的是当前版本数据)</span><br><span class="line">	2.1 命令 set /ukoko 100 1   如果设置数据的版本,与dataVersion不相同会报version No is not valid(版本号无效)</span><br><span class="line">	2.2 查看数据 get /ukoko</span><br></pre></td></tr></table></figure>

<ul>
<li><ul>
<li>获取节点</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. 获取普通数据: get /ukoko</span><br><span class="line">2. 获取数据并且添加监听: get /ukoko watch</span><br><span class="line"></span><br><span class="line">查看节点数据,并使用watch监听之后,如果对数据节点进行set操作,那么监听器会自动回调  NodeDataChanged path:/ukoko</span><br></pre></td></tr></table></figure>

<ul>
<li><ul>
<li>查看节点状态</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. 查看节点状态: stat /ukoko</span><br><span class="line">2. 查看节点状态并对节点进行监听: stat /ukoko watch</span><br><span class="line"></span><br><span class="line">查看节点状态,并使用watch监听之后,如果对数据节点进行set操作,那么监听器会自动回调  NodeDataChanged path:/ukoko</span><br></pre></td></tr></table></figure>

<ul>
<li><ul>
<li>删除节点</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. 删除节点</span><br><span class="line">	1.1 命令 delete /ukoko 删除节点</span><br><span class="line">2. 删除带版本的节点</span><br><span class="line">	2.1 命令 delete /ukoko 1 如果后面带有版本那么要和dataVersion版本号相同</span><br></pre></td></tr></table></figure>

<h3 id="第3节-使用Java客户端操作znode"><a href="#第3节-使用Java客户端操作znode" class="headerlink" title="第3节 使用Java客户端操作znode"></a>第3节 使用Java客户端操作znode</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">zk的Java客户端常见的有两种:</span><br><span class="line">1. 官网提供的zk客户端           功能简单,使用不便,比较底层</span><br><span class="line">2. Apache提供的curator客户端    功能丰富,使用方便</span><br></pre></td></tr></table></figure>

<h4 id="3-1-zk客户端依赖"><a href="#3-1-zk客户端依赖" class="headerlink" title="3.1 zk客户端依赖"></a>3.1 zk客户端依赖</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">/*  zk官网提供  */</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;zookeeper&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.4.9&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">/* </span><br><span class="line">	apache提供</span><br><span class="line">	curator官网: https://curator.apache.org/</span><br><span class="line">	如果zookeeper服务版本使用3.4.x 对应的curator版本4.2.x</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.apache.curator&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;curator-recipes&lt;/artifactId&gt;</span><br><span class="line">	&lt;version&gt;4.2.0&lt;/version&gt;</span><br><span class="line">	&lt;exclusions&gt;</span><br><span class="line">		&lt;exclusion&gt;</span><br><span class="line">			&lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;zookeeper&lt;/artifactId&gt;</span><br><span class="line">		&lt;/exclusion&gt;</span><br><span class="line">	&lt;/exclusions&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;zookeeper&lt;/artifactId&gt;</span><br><span class="line">	&lt;version&gt;3.4.9&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-节点数据操作"><a href="#3-2-节点数据操作" class="headerlink" title="3.2 节点数据操作"></a>3.2 节点数据操作</h4><h5 id="3-2-1-zookeeper操作"><a href="#3-2-1-zookeeper操作" class="headerlink" title="3.2.1 zookeeper操作"></a>3.2.1 zookeeper操作</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test01() throws IOException, KeeperException, InterruptedException &#123;</span><br><span class="line">	//服务器地址: 格式：ip:port ,如果是集群 ip1:port1,ip2:port2,ip3:port3</span><br><span class="line">	String connectString=&quot;127.0.0.1:2181&quot;;</span><br><span class="line">	//会话超时时间</span><br><span class="line">	int sessionTimeout=3000;</span><br><span class="line"></span><br><span class="line">	//创建zk连接</span><br><span class="line">	ZooKeeper zk = new ZooKeeper(connectString, sessionTimeout, new Watcher() &#123;</span><br><span class="line">		/**</span><br><span class="line">		 * Watcher: 监控所有被触发的事件</span><br><span class="line">		 * 触发执行process方法</span><br><span class="line">		 */</span><br><span class="line">		@Override</span><br><span class="line">		public void process(WatchedEvent event) &#123;</span><br><span class="line">			System.out.println(&quot;事件触发: &quot;+event);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">	//创建一个持久化节点</span><br><span class="line">	//zk.create(&quot;/app1&quot;,&quot;val&quot;.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);</span><br><span class="line">	//创建一个持久化子节点在app1节点下</span><br><span class="line">	//zk.create(&quot;/app1/app1_1&quot;,&quot;val1&quot;.getBytes(),ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);</span><br><span class="line"></span><br><span class="line">	//获取/app1节点数据</span><br><span class="line">	byte[] d1 = zk.getData(&quot;/app1&quot;, false, null);</span><br><span class="line">	System.out.println(&quot;d1= &quot;+new String(d1));</span><br><span class="line">	//获取/app1/app1_1节点数据</span><br><span class="line">	byte[] c1 = zk.getData(&quot;/app1/app1_1&quot;, false, null);</span><br><span class="line">	System.out.println(&quot;c1= &quot;+new String(c1));</span><br><span class="line">	//获取子节点目录列表</span><br><span class="line">	List&lt;String&gt; cList = zk.getChildren(&quot;/app1&quot;, false);</span><br><span class="line">	System.out.println(&quot;cList= &quot;+cList);</span><br><span class="line"></span><br><span class="line">	//修改目录节点数据(如果版本为-1,那么版本自动增加)</span><br><span class="line">	//zk.setData(&quot;/app1&quot;,&quot;valllll&quot;.getBytes(),-1);</span><br><span class="line">	//修改子目录节点数据</span><br><span class="line">	//zk.setData(&quot;/app1/app1_1&quot;,&quot;valLLLLL&quot;.getBytes(),-1);</span><br><span class="line"></span><br><span class="line">	/*</span><br><span class="line">		删除节点(如果存在子节点,不能删除父节点)</span><br><span class="line">		版本如果为-1,那么删除任意版本</span><br><span class="line">	 */</span><br><span class="line">	zk.delete(&quot;/app1/app1_1&quot;,-1);</span><br><span class="line">	zk.delete(&quot;/app1&quot;,-1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-2-2-curator操作"><a href="#3-2-2-curator操作" class="headerlink" title="3.2.2 curator操作"></a>3.2.2 curator操作</h5><ul>
<li>curator基本操作</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test02() throws Exception &#123;</span><br><span class="line">	//服务器地址: 格式：ip:port ,如果是集群 ip1:port1,ip2:port2,ip3:port3</span><br><span class="line">	String connectString=&quot;127.0.0.1:2181&quot;;</span><br><span class="line">	/*</span><br><span class="line">		重试机制</span><br><span class="line">		1. 等待重试时间</span><br><span class="line">		2. 重试次数</span><br><span class="line">	 */</span><br><span class="line">	RetryPolicy retryPolicy = new ExponentialBackoffRetry(1000,3);</span><br><span class="line">	//创建zk连接(方式一)</span><br><span class="line">	//CuratorFramework client = CuratorFrameworkFactory.newClient(connectString, retryPolicy);</span><br><span class="line"></span><br><span class="line">	//创建zk连接(方式二 Fluent风格[连缀风格的称呼])</span><br><span class="line">	CuratorFramework client = CuratorFrameworkFactory.builder()</span><br><span class="line">			.connectString(connectString)</span><br><span class="line">			.sessionTimeoutMs(5000) //会话超时时间</span><br><span class="line">			.connectionTimeoutMs(2000) //连接超时时间</span><br><span class="line">			.retryPolicy(retryPolicy)</span><br><span class="line">			.build();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	//启动客户端</span><br><span class="line">	client.start();</span><br><span class="line"></span><br><span class="line">	/*数据节点操作*/</span><br><span class="line"></span><br><span class="line">	/*</span><br><span class="line">		1. 创建持久节点(不设置值)</span><br><span class="line">	 */</span><br><span class="line">	//client.create().forPath(&quot;/app1&quot;); //默认创建持久节点</span><br><span class="line"></span><br><span class="line">	/*</span><br><span class="line">		2. 创建持久节点(设置值)</span><br><span class="line">	 */</span><br><span class="line">	//client.create().forPath(&quot;/app2&quot;,&quot;我是值&quot;.getBytes());</span><br><span class="line"></span><br><span class="line">	/*</span><br><span class="line">		3. 创建顺序持久节点(使用withMode函数设置)</span><br><span class="line">	 */</span><br><span class="line">	//client.create().withMode(CreateMode.PERSISTENT_SEQUENTIAL).forPath(&quot;/app3&quot;,&quot;我是值3&quot;.getBytes(&quot;utf-8&quot;));</span><br><span class="line"></span><br><span class="line">	/*</span><br><span class="line">		4. 创建持久节点(如果父节点不存在,递归创建)</span><br><span class="line">	 */</span><br><span class="line">	//父节点不存在创建子节点报异常(org.apache.zookeeper.KeeperException$NoNodeException: KeeperErrorCode = NoNode for /app4/app4_1)</span><br><span class="line">	//client.create().forPath(&quot;/app4/app4_1&quot;,&quot;我是值4&quot;.getBytes());</span><br><span class="line">	//父节点不存在创建子节点可以递归创建(creatingParentContainersIfNeeded方法可以递归创建)</span><br><span class="line">	//client.create().creatingParentContainersIfNeeded().withMode(CreateMode.PERSISTENT).forPath(&quot;/app5/app5_2&quot;,&quot;我是值6&quot;.getBytes(&quot;utf-8&quot;));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	/*</span><br><span class="line">		5. 删除数据节点</span><br><span class="line">	 */</span><br><span class="line">	//client.delete().forPath(&quot;/app&quot;);</span><br><span class="line"></span><br><span class="line">	/*</span><br><span class="line">		6. 删除节点(递归删除其所有子节点)</span><br><span class="line">	 */</span><br><span class="line">	//client.delete().deletingChildrenIfNeeded().forPath(&quot;/app4&quot;);</span><br><span class="line"></span><br><span class="line">	/*</span><br><span class="line">		7. 获取节点数据</span><br><span class="line">	 */</span><br><span class="line">	byte[] s2 = client.getData().forPath(&quot;/app2&quot;);</span><br><span class="line">	System.out.println(&quot;app2节点数据: &quot;+new String(s2));</span><br><span class="line"></span><br><span class="line">	/*</span><br><span class="line">		8. 设置节点数据</span><br><span class="line">	 */</span><br><span class="line">	//更新节点数据</span><br><span class="line">	//client.setData().forPath(&quot;/app2&quot;,&quot;我是值2&quot;.getBytes(&quot;utf-8&quot;));</span><br><span class="line">	//更新节点数据带版本(版本设置-1位默认值,默认递增,如果随便设置值回报异常[BadVersionException])</span><br><span class="line">	//client.setData().withVersion(-1).forPath(&quot;/app2&quot;,&quot;我是修改值2&quot;.getBytes(&quot;utf-8&quot;));</span><br><span class="line"></span><br><span class="line">	/*</span><br><span class="line">		9. 检查节点是否存在</span><br><span class="line">	 */</span><br><span class="line">	Stat stat = client.checkExists().forPath(&quot;/app2&quot;);</span><br><span class="line">	System.out.println(&quot;当前节点详情: &quot;+stat);</span><br><span class="line"></span><br><span class="line">	/*</span><br><span class="line">		10. 获取某个节点的所有子节点路径</span><br><span class="line">	 */</span><br><span class="line">	List&lt;String&gt; list = client.getChildren().forPath(&quot;/app5&quot;);</span><br><span class="line">	list.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>curator高级操作</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test03() throws Exception &#123;</span><br><span class="line">	//服务器地址: 格式：ip:port ,如果是集群 ip1:port1,ip2:port2,ip3:port3</span><br><span class="line">	String connectString=&quot;127.0.0.1:2181&quot;;</span><br><span class="line">	/*</span><br><span class="line">		重试机制</span><br><span class="line">		1. 等待重试时间</span><br><span class="line">		2. 重试次数</span><br><span class="line">	*/</span><br><span class="line">	RetryPolicy retryPolicy = new ExponentialBackoffRetry(1000,3);</span><br><span class="line">	//创建zk连接(方式二 Fluent风格[连缀风格的称呼])</span><br><span class="line">	CuratorFramework client = CuratorFrameworkFactory.builder()</span><br><span class="line">			.connectString(connectString)</span><br><span class="line">			.sessionTimeoutMs(5000) //会话超时时间</span><br><span class="line">			.connectionTimeoutMs(2000) //连接超时时间</span><br><span class="line">			.retryPolicy(retryPolicy)</span><br><span class="line">			.build();</span><br><span class="line"></span><br><span class="line">	//开启客户端</span><br><span class="line">	client.start();</span><br><span class="line"></span><br><span class="line">	//给某一个节点下的所有子节点添加监听(修改节点),多次操作节点只触发一次监听</span><br><span class="line">	client.getChildren().usingWatcher(new CuratorWatcher() &#123;</span><br><span class="line">		@Override</span><br><span class="line">		public void process(WatchedEvent event) throws Exception &#123;</span><br><span class="line">			System.out.println(&quot;事件: &quot;+event.toString());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;).forPath(&quot;/&quot;);</span><br><span class="line"></span><br><span class="line">	//创建/app1节点(事件触发)</span><br><span class="line">	//client.create().creatingParentContainersIfNeeded().forPath(&quot;/app1&quot;);</span><br><span class="line"></span><br><span class="line">	//设置值(事件不触发)</span><br><span class="line">	//client.setData().forPath(&quot;/app1&quot;,&quot;app1&quot;.getBytes());</span><br><span class="line"></span><br><span class="line">	//删除节点(事件触发)</span><br><span class="line">	//client.delete().forPath(&quot;/app1&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="第五章-zookeeper的高可用"><a href="#第五章-zookeeper的高可用" class="headerlink" title="第五章 zookeeper的高可用"></a>第五章 zookeeper的高可用</h2><ul>
<li>zk集群介绍</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">单点zk服务在正式环境很容易造成单点故障,导致服务器不可用,为了解决这个问题,需要将zk服务部署成集群,可以解决单点问题.</span><br><span class="line"></span><br><span class="line">zk集群的设计:</span><br><span class="line">	1. CAP定理之CP设计</span><br><span class="line">		1.1 CPA定理概念(Consistency[一致性]、Availability[可用性]、Partition tolerance[分区容错性])</span><br><span class="line">		1.2 在分布式系统中不可能保证CAP全部实现,一般提供CP或者AP服务</span><br><span class="line">		1.3 zk是一个典型的CP设计</span><br><span class="line">	2. 集群过半可存活(过半提供服务,低于一半主机不对外提供服务)</span><br><span class="line">		2.1 集群部署节点数一般为奇数个,因为过半可存活原理偶数可能浪费机器(3个节点和4个节点是一样的)</span><br><span class="line">		2.2 防止脑裂(一个zk集群[5个节点由于网络原因分成了3个和2个单独成为了各自的集群],这就是脑裂)</span><br><span class="line">		2.3 过半可存活策略可以很好的解决出现脑裂造成数据不一致的问题</span><br></pre></td></tr></table></figure>

<ul>
<li>集群配置</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">我们以3个实例节点作为例子部署,正常每一个节点分别在不同的机器上面,由于硬件有限,将3个节点部署到一台机器上进行测试</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">部署方式和但实力节点差不多,就是需要修改多份配置文件</span><br></pre></td></tr></table></figure>

<ul>
<li><ul>
<li>zk1实例</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">1. 解压zk压缩包</span><br><span class="line">2. 在解压文件中创建data(在data文件中创建myid文件,并且存一个服务器编号)和log文件夹 和bin目录平级即可</span><br><span class="line">3. 修改conf中的zoo_sample.cfg配置文件,重命名为zoo.cfg</span><br><span class="line">4. 修改配置文件内容,内容如下:</span><br><span class="line"></span><br><span class="line"># 心跳检测(zk服务器和zk客户端之间每隔一个tickTime检查一次是否还连着[毫秒])</span><br><span class="line">tickTime=2000</span><br><span class="line"># zk和zk之间(leader和follower)初始化连接时能忍受几个tickTime的个数,超过个数没有连接,剔除</span><br><span class="line">initLimit=10</span><br><span class="line"># zk和zk(leader和follower)之间发送消息请求和应答的时间长度多少个tickTime数量</span><br><span class="line">syncLimit=5</span><br><span class="line"># 数据存储位置</span><br><span class="line">dataDir=../data</span><br><span class="line"># 事务日志存储位置</span><br><span class="line">dataLogDir=../log</span><br><span class="line"># 端口号</span><br><span class="line">clientPort=2181</span><br><span class="line"># 集群配置 server.A=B.C.D  解释: server集群配置属性(固定值) 1:和myid中存的值相同用于表示当前zk的服务编号 B:服务器主机IP C: zk服务器之间通信端口 D:zk选举端口</span><br><span class="line">server.1=127.0.0.1:2555:3555</span><br><span class="line">server.2=127.0.0.1:2556:3556</span><br><span class="line">server.3=127.0.0.1:2557:3557</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><ul>
<li>zk2实例</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">1. 解压zk压缩包</span><br><span class="line">2. 在解压文件中创建data(在data文件中创建myid文件,并且存一个服务器编号)和log文件夹 和bin目录平级即可</span><br><span class="line">3. 修改conf中的zoo_sample.cfg配置文件,重命名为zoo.cfg</span><br><span class="line">4. 修改配置文件内容,内容如下:</span><br><span class="line"></span><br><span class="line"># 心跳检测(zk服务器和zk客户端之间每隔一个tickTime检查一次是否还连着[毫秒])</span><br><span class="line">tickTime=2000</span><br><span class="line"># zk和zk之间(leader和follower)初始化连接时能忍受几个tickTime的个数,超过个数没有连接,剔除</span><br><span class="line">initLimit=10</span><br><span class="line"># zk和zk(leader和follower)之间发送消息请求和应答的时间长度多少个tickTime数量</span><br><span class="line">syncLimit=5</span><br><span class="line"># 数据存储位置</span><br><span class="line">dataDir=../data</span><br><span class="line"># 事务日志存储位置</span><br><span class="line">dataLogDir=../log</span><br><span class="line"># 端口号</span><br><span class="line">clientPort=2182</span><br><span class="line"># 集群配置 server.A=B.C.D  解释: server集群配置属性(固定值) 2:和myid中存的值相同用于表示当前zk的服务编号 B:服务器主机IP C: zk服务器之间通信端口 D:zk选举端口</span><br><span class="line">server.1=127.0.0.1:2555:3555</span><br><span class="line">server.2=127.0.0.1:2556:3556</span><br><span class="line">server.3=127.0.0.1:2557:3557</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><ul>
<li>zk3实例</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">1. 解压zk压缩包</span><br><span class="line">2. 在解压文件中创建data(在data文件中创建myid文件,并且存一个服务器编号)和log文件夹 和bin目录平级即可</span><br><span class="line">3. 修改conf中的zoo_sample.cfg配置文件,重命名为zoo.cfg</span><br><span class="line">4. 修改配置文件内容,内容如下:</span><br><span class="line"></span><br><span class="line"># 心跳检测(zk服务器和zk客户端之间每隔一个tickTime检查一次是否还连着[毫秒])</span><br><span class="line">tickTime=2000</span><br><span class="line"># zk和zk之间(leader和follower)初始化连接时能忍受几个tickTime的个数,超过个数没有连接,剔除</span><br><span class="line">initLimit=10</span><br><span class="line"># zk和zk(leader和follower)之间发送消息请求和应答的时间长度多少个tickTime数量</span><br><span class="line">syncLimit=5</span><br><span class="line"># 数据存储位置</span><br><span class="line">dataDir=../data</span><br><span class="line"># 事务日志存储位置</span><br><span class="line">dataLogDir=../log</span><br><span class="line"># 端口号</span><br><span class="line">clientPort=2183</span><br><span class="line"># 集群配置 server.A=B.C.D  解释: server集群配置属性(固定值) 3:和myid中存的值相同用于表示当前zk的服务编号 B:服务器主机IP C: zk服务器之间通信端口 D:zk选举端口</span><br><span class="line">server.1=127.0.0.1:2555:3555</span><br><span class="line">server.2=127.0.0.1:2556:3556</span><br><span class="line">server.3=127.0.0.1:2557:3557</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">将各个节点启动,然后使用客户端连接其中的某一个进行测试.</span><br></pre></td></tr></table></figure>

<h2 id="第六章-配置中心"><a href="#第六章-配置中心" class="headerlink" title="第六章 配置中心"></a>第六章 配置中心</h2><h3 id="第1节-在Java项目中时时获取zk数据"><a href="#第1节-在Java项目中时时获取zk数据" class="headerlink" title="第1节 在Java项目中时时获取zk数据"></a>第1节 在Java项目中时时获取zk数据</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">举例: 以京东宙斯开放平台举例,平台地址为 https://jos.jd.com/</span><br><span class="line"></span><br><span class="line">场景说明: </span><br><span class="line">1. 我有一个项目,要从京东宙斯平台提供的接口获取数据,京东宙斯地址假设为  192.168.1.100</span><br><span class="line">2. 恰逢双十一我们平台可能非常频繁的调用京东宙斯的接口,京东宙斯平台也会根据双十一调整机房的容量,调整外部应用的访问地址调整为容量更大的 192.168.1.200</span><br><span class="line">3. 由于切换地址正常情况下需要我们停机器,修改项目本地配置,然后在重新启动,这样的缺点就是需要停服务.有没有一种方式可以不停服务直接进行动态的地址切换呢?</span><br><span class="line">4. zk的配置中心可以帮助我们解决这个问题</span><br></pre></td></tr></table></figure>

<h4 id="1-1-案例实现一"><a href="#1-1-案例实现一" class="headerlink" title="1.1 案例实现一"></a>1.1 案例实现一</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 创建JavaWeb项目,添加zk客户端依赖</span><br><span class="line">2. 将数据保存到zk节点中</span><br><span class="line">3. 在项目中使用zk客户端获取zk服务器节点数据</span><br><span class="line"></span><br><span class="line">以JavaWeb项目是ssm项目为例</span><br></pre></td></tr></table></figure>

<ul>
<li>Spring配置文件</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">	实例化zk客户端</span><br><span class="line">	CuratorFrameworkFactory静态工厂类</span><br><span class="line">	设置工厂方法 factory-method为newClient,IOC容器实例化这个工厂类时返回的对象是newClient的返回值对象</span><br><span class="line">	init-method：设置初始化方法为start,工厂类实例化完成后启动客户端</span><br><span class="line">--&gt;</span><br><span class="line">&lt;bean id=&quot;client&quot; class=&quot;org.apache.curator.framework.CuratorFrameworkFactory&quot; factory-method=&quot;newClient&quot; init-method=&quot;start&quot;&gt;</span><br><span class="line">	&lt;!--zk集群地址,多个使用逗号分隔--&gt;</span><br><span class="line">	&lt;constructor-arg index=&quot;0&quot; value=&quot;127.0.0.1:2181&quot;&gt;&lt;/constructor-arg&gt;</span><br><span class="line">	&lt;!--会话超时时间--&gt;</span><br><span class="line">	&lt;constructor-arg index=&quot;1&quot; value=&quot;5000&quot;&gt;&lt;/constructor-arg&gt;</span><br><span class="line">	&lt;!--连接超时时间--&gt;</span><br><span class="line">	&lt;constructor-arg index=&quot;2&quot; value=&quot;3000&quot;&gt;&lt;/constructor-arg&gt;</span><br><span class="line">	&lt;!--重试机制--&gt;</span><br><span class="line">	&lt;constructor-arg index=&quot;3&quot; ref=&quot;retry&quot;&gt;&lt;/constructor-arg&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line">&lt;!--</span><br><span class="line">	重试机制</span><br><span class="line">--&gt;</span><br><span class="line">&lt;bean id=&quot;retry&quot; class=&quot;org.apache.curator.retry.ExponentialBackoffRetry&quot;&gt;</span><br><span class="line">	&lt;constructor-arg index=&quot;0&quot; value=&quot;3000&quot;&gt;&lt;/constructor-arg&gt;</span><br><span class="line">	&lt;constructor-arg index=&quot;1&quot; value=&quot;3&quot;&gt;&lt;/constructor-arg&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>控制器中调用</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//IOC容器注入</span><br><span class="line">@Autowired</span><br><span class="line">private CuratorFramework client;</span><br><span class="line"></span><br><span class="line">@RequestMapping(value = &quot;/hello2&quot;)</span><br><span class="line">public String hello2() throws Exception &#123;</span><br><span class="line">	//获取节点数据</span><br><span class="line">	byte[] bytes = client.getData().forPath(&quot;/app&quot;);</span><br><span class="line">	String s = new String(bytes, &quot;utf-8&quot;);</span><br><span class="line">	System.out.println(&quot;s=&quot;+s);</span><br><span class="line">	return &quot;ok&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-2-案例实现二"><a href="#1-2-案例实现二" class="headerlink" title="1.2 案例实现二"></a>1.2 案例实现二</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">案例一缺点就是每次都需要zk客户端去数据节点查询数据,性能较差(网络延时)</span><br><span class="line">案例二将zk服务器数据节点数据缓存到内存中,如果数据节点发生变化,使用zk监听器监听并修改缓存</span><br><span class="line"></span><br><span class="line">案例二建立在案例一 配置文件基础之上</span><br><span class="line"></span><br><span class="line">Curator监听器是对zookeeper基本watch的包装,可以实现循环注册和监听主要涉及到三个监听器:</span><br><span class="line"></span><br><span class="line">1. 监听某一个节点的子节点变化  --  PathChildrenCache</span><br><span class="line">2. 监听特定的某一个节点        -- NodeCache</span><br><span class="line">3. 监听某一个节点的所有的后代节点  -- TreeCache</span><br></pre></td></tr></table></figure>

<ul>
<li><p>编写监听器</p>
</li>
<li><ul>
<li>监听器一(监听某一个节点的子节点变化)</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.curator.framework.CuratorFramework;</span><br><span class="line">import org.apache.curator.framework.recipes.cache.PathChildrenCache;</span><br><span class="line">import org.apache.curator.framework.recipes.cache.PathChildrenCacheListener;</span><br><span class="line">/**</span><br><span class="line"> * 监听某一个点的所有子节点</span><br><span class="line"> */</span><br><span class="line">public class ChildrenCacheListenerTool1 &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 构造器</span><br><span class="line">     * @param client</span><br><span class="line">     * @param path</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    public ChildrenCacheListenerTool1(CuratorFramework client, String path) throws Exception &#123;</span><br><span class="line">        /*</span><br><span class="line">            监听某一个点下的子节点</span><br><span class="line">            第一个参数: zk客户端</span><br><span class="line">            第二个参数: 节点路径</span><br><span class="line">            第三个参数: 如果为true缓存数据节点内容</span><br><span class="line">         */</span><br><span class="line">        PathChildrenCache cache = new PathChildrenCache(client, path, true);</span><br><span class="line">        //开启PathChildrenCache</span><br><span class="line">        cache.start();</span><br><span class="line">        /*</span><br><span class="line">            设置监听,创建PathChildrenCacheListener监听对象</span><br><span class="line">            第一个参数: zk客户端</span><br><span class="line">            第二个参数: 事件对象</span><br><span class="line">         */</span><br><span class="line">        PathChildrenCacheListener listener = (x,event)-&gt;&#123;</span><br><span class="line">            System.out.println(&quot;节点名称: &quot;+event.getData().getPath());</span><br><span class="line">            System.out.println(&quot;事件名称:&quot;+event.getType()+&quot;&lt;&lt;---&gt;&gt;节点数据: &quot;+(event.getData()!=null ? new String(event.getData().getData(),&quot;utf-8&quot;):&quot;数据为空&quot;));</span><br><span class="line">            //节点数据发生变化监听执行,将数据写到缓存中,比如写到redis</span><br><span class="line">        &#125;;</span><br><span class="line">        //添加监听</span><br><span class="line">        cache.getListenable().addListener(listener);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><ul>
<li>监听器二(监听特定的某一个节点变化)</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><ul>
<li>监听器三(监听某一个节点的所有的后代节点)</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.curator.framework.CuratorFramework;</span><br><span class="line">import org.apache.curator.framework.recipes.cache.NodeCache;</span><br><span class="line">import org.apache.curator.framework.recipes.cache.NodeCacheListener;</span><br><span class="line">/**</span><br><span class="line"> * 监听某一个特定节点</span><br><span class="line"> */</span><br><span class="line">public class ChildrenCacheListenerTool2 &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 构造器</span><br><span class="line">     * @param client</span><br><span class="line">     * @param path</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    public ChildrenCacheListenerTool2(CuratorFramework client, String path) throws Exception &#123;</span><br><span class="line">        /*</span><br><span class="line">            监听某一个特定节点</span><br><span class="line">            第一个参数: zk客户端</span><br><span class="line">            第二个参数: 节点路径</span><br><span class="line">         */</span><br><span class="line">        NodeCache cache = new NodeCache(client, path);</span><br><span class="line">        //开启NodeCache</span><br><span class="line">        cache.start();</span><br><span class="line">        //设置监听,创建NodeCacheListener监听对象</span><br><span class="line">        NodeCacheListener listener = ()-&gt;&#123;</span><br><span class="line">            System.out.println(&quot;app节点名称: &quot;+cache.getPath());</span><br><span class="line">            System.out.println(&quot;app节点数据: &quot;+(cache.getCurrentData()!=null ? new String(cache.getCurrentData().getData(),&quot;utf-8&quot;):&quot;节点被删除空&quot;));</span><br><span class="line">            //节点数据发生变化监听执行,将数据写到缓存中,比如写到redis</span><br><span class="line">        &#125;;</span><br><span class="line">        //添加监听</span><br><span class="line">        cache.getListenable().addListener(listener);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><ul>
<li>将三个监听配置到xml配置文件中</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">	注册监听某一个点的所有子节点</span><br><span class="line">--&gt;</span><br><span class="line">&lt;bean class=&quot;io.ukoko.listeners.ChildrenCacheListenerTool1&quot;&gt;</span><br><span class="line">	&lt;constructor-arg index=&quot;0&quot; ref=&quot;client&quot;&gt;&lt;/constructor-arg&gt;</span><br><span class="line">	&lt;constructor-arg index=&quot;1&quot; value=&quot;/&quot;&gt;&lt;/constructor-arg&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--</span><br><span class="line">	注册监听某一个特定节点</span><br><span class="line">--&gt;</span><br><span class="line">&lt;bean class=&quot;io.ukoko.listeners.ChildrenCacheListenerTool2&quot;&gt;</span><br><span class="line">	&lt;constructor-arg index=&quot;0&quot; ref=&quot;client&quot;&gt;&lt;/constructor-arg&gt;</span><br><span class="line">	&lt;constructor-arg index=&quot;1&quot; value=&quot;/app&quot;&gt;&lt;/constructor-arg&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line">&lt;!--</span><br><span class="line">	注册监听某个节点下的所有节点,包含后代节点</span><br><span class="line">--&gt;</span><br><span class="line">&lt;bean class=&quot;io.ukoko.listeners.ChildrenCacheListenerTool3&quot;&gt;</span><br><span class="line">	&lt;constructor-arg index=&quot;0&quot; ref=&quot;client&quot;&gt;&lt;/constructor-arg&gt;</span><br><span class="line">	&lt;constructor-arg index=&quot;1&quot; value=&quot;/&quot;&gt;&lt;/constructor-arg&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><ul>
<li>使用zkCli.sh或者zkCli.cmd 测试</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">使用zk的常见命令在客户端进行操作,查看监听是否会被执行...</span><br></pre></td></tr></table></figure>

<h3 id="第2节-Config-Toolkit可视化配置中心"><a href="#第2节-Config-Toolkit可视化配置中心" class="headerlink" title="第2节 Config-Toolkit可视化配置中心"></a>第2节 Config-Toolkit可视化配置中心</h3><h4 id="2-1-Config-Toolkit简介"><a href="#2-1-Config-Toolkit简介" class="headerlink" title="2.1 Config-Toolkit简介"></a>2.1 Config-Toolkit简介</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">介绍: Config-Toolkit是一款由当当网开源的分布式配置管理工具,通过web界面维护属性配置和配置的导入导出功能</span><br><span class="line"></span><br><span class="line">特性:</span><br><span class="line">	1. 集中管理集群配置</span><br><span class="line">	2. 实现配置热更新</span><br><span class="line">	3. 多配置源支持，内置支持zookeeper、本地文件、http协议</span><br><span class="line">	4. Spring集成</span><br><span class="line">	5. web界面管理配置</span><br><span class="line">	...</span><br><span class="line"></span><br><span class="line">环境:</span><br><span class="line">	1. JAVA 7+</span><br><span class="line">	2. TOMCAT 7+ for ConfigWeb</span><br></pre></td></tr></table></figure>

<h4 id="2-2-Config-Toolkit下载地址"><a href="#2-2-Config-Toolkit下载地址" class="headerlink" title="2.2 Config-Toolkit下载地址"></a>2.2 Config-Toolkit下载地址</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. GitEE地址  : https://gitee.com/mirrors/Config-Toolkit</span><br><span class="line">2. GitHub地址 : https://github.com/dangdangdotcom/config-toolkit</span><br></pre></td></tr></table></figure>

<h4 id="2-3-Config-Toolkit安装"><a href="#2-3-Config-Toolkit安装" class="headerlink" title="2.3 Config-Toolkit安装"></a>2.3 Config-Toolkit安装</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 下载源码  git clone https://gitee.com/mirrors/Config-Toolkit.git</span><br><span class="line">2. 编译源码  mvn clean package -Dmaven.test.skip=true </span><br><span class="line">3. 运行: </span><br><span class="line">	3.1 进入项目目录  cd Config-Toolkit\config-face\target</span><br><span class="line">	3.2 执行运行命令  java -jar config-face.jar --zk=localhost:2181</span><br></pre></td></tr></table></figure>

<h4 id="2-4-Config-Toolkit使用"><a href="#2-4-Config-Toolkit使用" class="headerlink" title="2.4 Config-Toolkit使用"></a>2.4 Config-Toolkit使用</h4><ul>
<li>访问</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">config-face项目运行起来之后 通过地址访问: http://localhost:8080  需要用户名和密码</span><br><span class="line"></span><br><span class="line">1. 用户名/密码创建</span><br><span class="line">	1.1 启动zookeeper服务器,使用zkCli.sh客户端连接上服务器</span><br><span class="line">	1.2 创建/projectx节点,并赋初始化值   命令  create /projectx 1</span><br><span class="line">	1.3 创建子节点create /projectx/modulex a9993e364706816aba3e25717850c26c9cd0d89d 并赋初始化值,这个初始化值是一个使用sha1加密之后的密文(本文密文为官网提供对应明文abc)</span><br><span class="line">	1.4 用户名和密码创建完成(密码密文对应明文为abc,用户名为/projectx/modulex这个根节点目录)</span><br><span class="line">2. 访问http://localhost:8080这个地址使用 用户名:/projectx/modulex 和 密码: abc 登录即可进入页面</span><br><span class="line"></span><br><span class="line">下面是第一次登录成功的页面</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<table>
    <tr>
        <td style="font-size:12px;text-align:center;">登陆页面</td>
        <td style="font-size:12px;text-align:center;">登陆成功初始化页面</td>
    </tr>
    <tr>
        <td>
            <img src="https://note.youdao.com/yws/api/personal/file/WEB6bc43e0148ec9cb8171795ec662d6f44?method=download&shareKey=b69393e2b42212ad7e876511f2e0b904">
        </td>
        <td>
            <img src="https://note.youdao.com/yws/api/personal/file/WEBd0726e08fc0eeab8c700edaf0f2657c7?method=download&shareKey=cdadceeb16e68767bba605cfad2b22a3">
        </td>
    </tr>
</table>

<ul>
<li>页面配置文件操作</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. 创建版本</span><br><span class="line">2. 创建群组</span><br><span class="line">3. 选中群组并且在群组中设置key-value键值对的配置信息</span><br></pre></td></tr></table></figure>

<img src="https://note.youdao.com/yws/api/personal/file/WEB134023e11301692196643204f95658d4?method=download&shareKey=d9204cdd6ab11be04933de5b3a947e6e">

<img src="https://note.youdao.com/yws/api/personal/file/WEB43d73524c47cce02d098f6a071c1af56?method=download&shareKey=ef272735f6ffff8dd266dc5580887424">

<img src="https://note.youdao.com/yws/api/personal/file/WEBa5e0a13dd7e6198425f511665812ac22?method=download&shareKey=c3195d9de6287bceca65af05a07cf497">

<h4 id="2-5-Config-Tools-API使用"><a href="#2-5-Config-Tools-API使用" class="headerlink" title="2.5 Config-Tools API使用"></a>2.5 Config-Tools API使用</h4><ul>
<li>添加依赖</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;com.dangdang&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;config-toolkit&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;3.3.2-RELEASE&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>通过API获取配置信息</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//创建ZookeeperConfigProfile加载zk的/projectx/modulex节点的1.0版本的配置</span><br><span class="line">ZookeeperConfigProfile configProfile = new ZookeeperConfigProfile(&quot;127.0.0.1:2181&quot;, &quot;/projectx/modulex&quot;, &quot;1.0&quot;);</span><br><span class="line">//创建GeneralConfigGroup获取群组名称为group1的群组</span><br><span class="line">GeneralConfigGroup group = new ZookeeperConfigGroup(configProfile,&quot;group1&quot;);</span><br><span class="line">//从群组中获取数据(通过key获取)</span><br><span class="line">String jdIp = group.get(&quot;jd_ip&quot;);</span><br><span class="line"></span><br><span class="line">支持热更新,在config-face操作页面修改配置,不需要重启应用直接获取</span><br></pre></td></tr></table></figure>

<h4 id="2-6-Config-Tools集成Spring"><a href="#2-6-Config-Tools集成Spring" class="headerlink" title="2.6 Config-Tools集成Spring"></a>2.6 Config-Tools集成Spring</h4><ul>
<li>spring配置文件的头约束</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">	xmlns:config=&quot;https://crnlmchina.github.io/config&quot;</span><br><span class="line">	xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span><br><span class="line">             https://crnlmchina.github.io/config https://crnlmchina.github.io/config/config.xsd&quot;&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>基础配置</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">	配置Config-Toolkit</span><br><span class="line">--&gt;</span><br><span class="line">&lt;!-- 1. 基础配置 --&gt;</span><br><span class="line">&lt;config:profile connect-str=&quot;127.0.0.1:2181&quot; root-node=&quot;/projectx/modulex&quot; version=&quot;1.0&quot;&gt;&lt;/config:profile&gt;</span><br><span class="line">&lt;!-- </span><br><span class="line">	2. 群组配置 </span><br><span class="line">		node属性: 操作页面设置的群组名称</span><br><span class="line">		id属性: 自定义,下面获取群组数据是需要</span><br><span class="line">--&gt;</span><br><span class="line">&lt;config:group node=&quot;group1&quot; id=&quot;gProp&quot;&gt;&lt;/config:group&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- </span><br><span class="line">	3. 自定义一个Java类,将gProp中的数据set到自定义的类对象中 </span><br><span class="line">	</span><br><span class="line">	public class ZkConfig &#123;</span><br><span class="line">		private String jdIp1;</span><br><span class="line">		private String jdIp2;</span><br><span class="line">	&#125;</span><br><span class="line">	从群组或获取数据采用SpEL表达式方式#&#123;goup[&#x27;key&#x27;]&#125; group为&lt;config:group&gt; 标签中的id属性值中括号里的key是操作界面自定义的key值</span><br><span class="line">--&gt;</span><br><span class="line">&lt;bean id=&quot;zkConfig&quot; class=&quot;io.ukoko.ZkConfig&quot;&gt;</span><br><span class="line">	&lt;property name=&quot;jdIp1&quot; value=&quot;#&#123;gProp[&#x27;jd_ip&#x27;]&#125;&quot;&gt;&lt;/property&gt;</span><br><span class="line">	&lt;property name=&quot;jdIp2&quot; value=&quot;#&#123;gProp[&#x27;jd_ip2&#x27;]&#125;&quot;&gt;&lt;/property&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">注意:xml配置默认不支持热更新</span><br></pre></td></tr></table></figure>

<ul>
<li>Java代码</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//注入</span><br><span class="line">@Autowired</span><br><span class="line">private ZkConfig zkConfig;</span><br><span class="line"></span><br><span class="line">@RequestMapping(value = &quot;/hello4&quot;)</span><br><span class="line">public String hello4()&#123;</span><br><span class="line">	System.out.println(&quot;zk配置信息: &quot;+zkConfig);</span><br><span class="line">	return &quot;ok&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>

    
    
    <div>
	
		<div style="text-align:center;color: #ccc;font-size:14px; padding-top: 10px;">----------------本文结束<i class="fa fa-paw"></i>感谢您的阅读---------------</div>
	
</div>

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/java/" rel="tag"># java</a>
              <a href="/tags/zookeeper/" rel="tag"># zookeeper</a>
              <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/" rel="tag"># 分布式配置中心</a>
              <a href="/tags/%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/" rel="tag"># 注册中心</a>
              <a href="/tags/zk/" rel="tag"># zk</a>
              <a href="/tags/config-toolkit/" rel="tag"># config-toolkit</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2024/07/02/Spring%E6%A1%86%E6%9E%B6/" rel="prev" title="Spring笔记">
      <i class="fa fa-chevron-left"></i> Spring笔记
    </a></div>
      <div class="post-nav-item">
    <a href="/2024/07/02/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88(%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90%E9%80%A0%E6%88%90%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1)/" rel="next" title="分布式事务解决方案(多数据源造成的分布式事务)">
      分布式事务解决方案(多数据源造成的分布式事务) <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E7%AB%A0-zookeeper%E7%AE%80%E4%BB%8B"><span class="nav-text">第一章 zookeeper简介</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC1%E8%8A%82-zookeeper%E7%9A%84%E7%94%B1%E6%9D%A5"><span class="nav-text">第1节 zookeeper的由来</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC2%E8%8A%82-zookeeper%E5%90%8D%E5%AD%97%E7%9A%84%E7%94%B1%E6%9D%A5"><span class="nav-text">第2节 zookeeper名字的由来</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC3%E8%8A%82-zk%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-text">第3节 zk应用场景</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E7%AB%A0-zk%E7%9A%84%E4%B8%8B%E8%BD%BD"><span class="nav-text">第二章 zk的下载</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E7%AB%A0-zk%E7%9A%84%E5%8D%95%E7%82%B9%E5%AE%89%E8%A3%85"><span class="nav-text">第三章 zk的单点安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E5%9B%9B%E7%AB%A0-zk%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BD%BF%E7%94%A8"><span class="nav-text">第四章 zk客户端使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC1%E8%8A%82-%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9E%E6%8E%A5"><span class="nav-text">第1节 客户端连接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC2%E8%8A%82-zk%E8%8A%82%E7%82%B9%E6%A6%82%E8%BF%B0"><span class="nav-text">第2节 zk节点概述</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-zk%E8%8A%82%E7%82%B9%E6%A6%82%E5%BF%B5"><span class="nav-text">2.1 zk节点概念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-zk%E8%8A%82%E7%82%B9%E7%B1%BB%E5%9E%8B"><span class="nav-text">2.2 zk节点类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-zk%E8%8A%82%E7%82%B9%E6%93%8D%E4%BD%9C"><span class="nav-text">2.3 zk节点操作</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC3%E8%8A%82-%E4%BD%BF%E7%94%A8Java%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%93%8D%E4%BD%9Cznode"><span class="nav-text">第3节 使用Java客户端操作znode</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-zk%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BE%9D%E8%B5%96"><span class="nav-text">3.1 zk客户端依赖</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-%E8%8A%82%E7%82%B9%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C"><span class="nav-text">3.2 节点数据操作</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-2-1-zookeeper%E6%93%8D%E4%BD%9C"><span class="nav-text">3.2.1 zookeeper操作</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-2-2-curator%E6%93%8D%E4%BD%9C"><span class="nav-text">3.2.2 curator操作</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%BA%94%E7%AB%A0-zookeeper%E7%9A%84%E9%AB%98%E5%8F%AF%E7%94%A8"><span class="nav-text">第五章 zookeeper的高可用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E5%85%AD%E7%AB%A0-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83"><span class="nav-text">第六章 配置中心</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC1%E8%8A%82-%E5%9C%A8Java%E9%A1%B9%E7%9B%AE%E4%B8%AD%E6%97%B6%E6%97%B6%E8%8E%B7%E5%8F%96zk%E6%95%B0%E6%8D%AE"><span class="nav-text">第1节 在Java项目中时时获取zk数据</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-%E6%A1%88%E4%BE%8B%E5%AE%9E%E7%8E%B0%E4%B8%80"><span class="nav-text">1.1 案例实现一</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-%E6%A1%88%E4%BE%8B%E5%AE%9E%E7%8E%B0%E4%BA%8C"><span class="nav-text">1.2 案例实现二</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC2%E8%8A%82-Config-Toolkit%E5%8F%AF%E8%A7%86%E5%8C%96%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83"><span class="nav-text">第2节 Config-Toolkit可视化配置中心</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-Config-Toolkit%E7%AE%80%E4%BB%8B"><span class="nav-text">2.1 Config-Toolkit简介</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-Config-Toolkit%E4%B8%8B%E8%BD%BD%E5%9C%B0%E5%9D%80"><span class="nav-text">2.2 Config-Toolkit下载地址</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-Config-Toolkit%E5%AE%89%E8%A3%85"><span class="nav-text">2.3 Config-Toolkit安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-Config-Toolkit%E4%BD%BF%E7%94%A8"><span class="nav-text">2.4 Config-Toolkit使用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-5-Config-Tools-API%E4%BD%BF%E7%94%A8"><span class="nav-text">2.5 Config-Tools API使用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-6-Config-Tools%E9%9B%86%E6%88%90Spring"><span class="nav-text">2.6 Config-Tools集成Spring</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="夜泊1990"
      src="/images/avatar.jpeg">
  <p class="site-author-name" itemprop="name">夜泊1990</p>
  <div class="site-description" itemprop="description">俱往矣,要多呲花,有多呲花</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">35</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">104</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">夜泊1990</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">687k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">10:25</span>
</div>
        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
